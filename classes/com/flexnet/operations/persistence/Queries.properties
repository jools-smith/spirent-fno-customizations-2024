#
# Esn queries
#
#XXXXX no mapping any more
#Esn.getByName = \
#	from com.flexnet.operations.bizobjects.Esn as esn \
#	where esn.esn_ = ? AND esn.null=:tenantId

#Esn.getByEntitlement= \
#	select esn \
#	from com.flexnet.operations.bizobjects.Esn as esn \
#	inner join esn.entitlements_ as entitlement \
#	where entitlement.id = ? AND esn.null=:tenantId

#Esn.getBulkEsnByWebRegKey= \
#	select esn \
#	from com.flexnet.operations.bizobjects.BulkEsn as esn \
#	inner join esn.webRegKeys_ as webRegKey \
#	where webRegKey.id = ? AND esn.null=:tenantId

#Esn.getActivatableEsnAndEntitlementPairs= \
#	(esn.esnType_ = 'bo.constants.esn.type.simple' OR esn.esnType_ = 'bo.constants.esn.type.webRegKey') AND esn.status_ = 'bo.constants.states.active' \
#	AND (entitlement.seatCount_ - item.fulfilledAmount) > 0
	
#
# Bulk Esn queries
#
#BulkEsn.getWebRegKeys = \
#	select esn, entitlement \
#	from com.flexnet.operations.bizobjects.BulkEsn as bulkEsn \
#	inner join bulkEsn.entitlements_ as entitlement \
#	inner join bulkEsn.webRegKeys_ as esn \
#	where bulkEsn.esn_ = ? AND bulkEsn.null=:tenantId

#BulkEsn.getWebRegKeysCount= \
#	select count(*) \
#	from com.flexnet.operations.bizobjects.BulkEsn as bulkEsn \
#	inner join bulkEsn.entitlements_ as entitlement \
#	inner join bulkEsn.webRegKeys_ as esn \
#	where bulkEsn.esn_ = ? AND bulkEsn.null=:tenantId
	
#
# Entitlement queries
#
#Entitlement.getDefault = \
#	from com.flexnet.operations.bizobjects.Entitlement as entitlement \
#	where entitlement.defaultObject_ \= true AND entitlement.null=:tenantId

#Entitlement.validateUnique= \
#	from com.flexnet.operations.bizobjects.Entitlement as entitlement \
#	inner join entitlement.orderable_ orderable \
#	where orderable.id = ? and entitlement.esn.esn_ = ? AND entitlement.null=:tenantId
#XXXXX Un-Used	
#Entitlement.filterSearch= \
#	select entitlement \
#	from com.flexnet.operations.bizobjects.Entitlement as entitlement \
#	{0} {1} order by {2}
#XXXXX Un-Used	
#Entitlement.filterSearchCount= \
#	select count(*) from com.flexnet.operations.bizobjects.Entitlement as entitlement \
#	{0} {1}
	
#
# Entitlement Item queries
#
#XXXXX Un-Used
#EntitlementItem.filterSearch= \
#	select item \
#	from com.flexnet.operations.bizobjects.EntitlementItem as item \
#	{0} {1} order by {2}
#XXXXX Un-Used
#EntitlementItem.filterSearchCount= \
#	select count(*) from com.flexnet.operations.bizobjects.EntitlementItem as item \
#	{0} {1}


#
# Entitlement BO queries
#Query build in Soruce so no where class can be added 
com.flexnet.operations.bizobjects.entitlements.EntitlementBO = \
	SELECT obj FROM com.flexnet.operations.bizobjects.entitlements.EntitlementBO AS obj
	
ActivatableItemBO.getByID=\
SELECT obj FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
	where obj.id = ? and obj.activatableItemType = ? AND obj.tenantId_=:tenantId
	
ActivatableItemBO.getByIDList=\
SELECT obj FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
	where obj.id in (:ids) and obj.activatableItemType = :type AND obj.tenantId_=:tenantId
	
ActivatableItemBO.getByLineItemIdList = SELECT obj \
    FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
    WHERE  obj.activationID_ IN (:activationIDs) and obj.activatableItemType = :type AND obj.tenantId_ = :tenantId \
    ORDER BY  obj.id ASC
   
MaintenanceItemDO.getByMaintIdList = SELECT obj \
    FROM com.flexnet.operations.bizobjects.MaintenanceItemDO AS obj \
    WHERE  obj.activationID_ IN (:activationIds) AND obj.tenantId_ = :tenantId \
    ORDER BY  obj.id ASC
    
MaintenanceItemDO.getByIdList = SELECT obj \
    FROM com.flexnet.operations.bizobjects.MaintenanceItemDO AS obj \
    WHERE  obj.id IN (:ids) AND obj.tenantId_ = :tenantId \
    ORDER BY  obj.id ASC
    
ActivatableItemBO.getCount=\
SELECT count(*) FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
	where obj.parentEntitlement_ = ? AND obj.tenantId_=:tenantId
	
ActivatableItemBO.getCountsByParentIds=\
SELECT  obj.parentEntitlement_.id, count(obj.id) FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
	where obj.parentEntitlement_.id in (:ids) AND obj.tenantId_=:tenantId \
	group by obj.parentEntitlement_.id
		
ActivationInstance.getByID=\
SELECT obj FROM com.flexnet.operations.bizobjects.ActivationInstance AS obj \
	where obj.id = ? and obj.fulfillmentType = ? AND obj.tenantId_=:tenantId
	
ActivationInstance.getByFulfillmentID=\
SELECT obj FROM com.flexnet.operations.bizobjects.ActivationInstance AS obj \
	where obj.fulfillmentId = ? and obj.fulfillmentType = ? AND obj.tenantId_=:tenantId
		
ActivationInstance.getByFulfillmentIDForAll=\
SELECT obj.fulfillmentId,obj FROM com.flexnet.operations.bizobjects.ActivationInstance AS obj \
	where obj.fulfillmentId in (:ids) and obj.fulfillmentType = :type AND obj.tenantId_=:tenantId	
		
BulkEntitlementBO.getWebRegKeys = \
	select webregkey \
	from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as webregkey \
	inner join webregkey.parentEntitlement_ as entitlement \
	inner join entitlement.parentBulkEntitlement_ as parenBulkEnt \
	where webregkey.isBulkLineItem_ = false and \
	(webregkey.parentEntitlement_.id = ? or parenBulkEnt.id = ?) AND webregkey.tenantId_=:tenantId
	
BulkEntitlementBO.getWebRegKeyEntitlements = \
	select entitlement \
	from com.flexnet.operations.bizobjects.entitlements.SimpleEntitlementBO as entitlement \
	inner join entitlement.parentBulkEntitlement_ parentBulkEntitlement \
	where parentBulkEntitlement.id = ? AND entitlement.tenantId_=:tenantId
	
BulkEntitlementBO.getWebRegKeysCount = \
	select count(webregkey) from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as webregkey \
	inner join webregkey.parentEntitlement_ as entitlement \
	inner join entitlement.parentBulkEntitlement_ as parenBulkEnt \
	where webregkey.isBulkLineItem_ = false and \
	(entitlement.id = ? or parenBulkEnt.id = ?) AND webregkey.tenantId_=:tenantId

BulkEntitlementBO.containsFulfillments = \
	select fulfillment from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as litem \
	inner join litem.parentEntitlement_ as entitlement \
	inner join entitlement.parentBulkEntitlement_ as parenBulkEnt \
	where parenBulkEnt.id = ? AND fulfillment.tenantId_=:tenantId

Orderable.containedInEntitlementLineItems = \
	select entitlementlineitem \
	from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as entitlementlineitem \
	inner join entitlementlineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	where orderable.id= ? AND entitlementlineitem.tenantId_=:tenantId
		
Orderable.containedInNonTestEntitlementLineItems = \
	select entitlement \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	where orderable.id= ? and entitlement.status_ != 'bo.constants.states.test' AND entitlement.tenantId_=:tenantId
	
Orderable.containedInDevices = \
	select device \
	from com.flexnet.operations.bizobjects.BaseProductDO as device \
	inner join device.orderable as orderables \
	where orderables.id = ? AND device.tenantId=:tenantId
		



Maintenance.containedInMaintenanceLineItems = \
	select maintlineitem \
	from com.flexnet.operations.bizobjects.MaintenanceItemDO as maintlineitem \
	inner join maintlineitem.orderable_ as orderable \
	where orderable.id= ? AND maintlineitem.tenantId_=:tenantId
		
Maintenance.containedInNonTestMaintenanceLineItems = \
	select maintlineitem \
	from com.flexnet.operations.bizobjects.MaintenanceItemDO as maintlineitem \
	inner join maintlineitem.orderable_ as orderable \
	where orderable.id= ? and maintlineitem.status_ != 'bo.constants.states.test' AND maintlineitem.tenantId_=:tenantId
	
Maintenance.getByID=\
SELECT obj FROM com.flexnet.operations.bizobjects.MaintenanceItemDO AS obj \
	where obj.id = ? AND obj.tenantId_=:tenantId
		
Entitlement.getProductCategories = \
	select productCategory \
   from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.productCategory_ as productCategory \
	where entitlement.id = ? AND entitlement.tenantId_=:tenantId
    
Entitlement.getProdCategoriesOrgs = \
   select org \
   from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.productCategory_ as productCategory \
	inner join productCategory.orgs_ as prodOrgCategory \
	inner join prodOrgCategory.orgUnit_ as org \
	where entitlement.id = ? AND entitlement.tenantId_=:tenantId
	
    
Entitlement.getLineItemsCount = \
   select count(lineItem.id) \
   from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	where entitlement.id = ? AND entitlement.tenantId_=:tenantId
		
	
EntitlementLineItem.getProdCategoriesOrgs = \
   select org \
   from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.productCategory_ as productCategory \
	inner join productCategory.orgs_ as prodOrgCategory \
	inner join prodOrgCategory.orgUnit_ as org \
	where lineItem.id = ?	 AND lineItem.tenantId_=:tenantId
	
	
	
EntitlementLineItem.getLineItemAttributes = \
   select lineItem.id as lineItemId , meta.name as name , meta.type as type, extProp.id as id, extProp.textValue as textValue,  extProp.numberValue as numberValue , extProp.dateValue as dateValue , extProp.booleanValue as booleanValue, multiTextValue.multiValue as multiValue \
   from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as lineItem \
	inner join lineItem.extendedPropertySet as extPropSet \
	inner join extPropSet.properties as extProp \
	inner join extProp.metadata_ as meta \
	left outer join extProp.multiTextValues as multiTextValue \
	where lineItem.id in (:ids)	\
    AND lineItem.tenantId_=:tenantId \
	AND extPropSet.tenantId_=:tenantId AND extProp.tenantId_=:tenantId AND meta.tenantId_=:tenantId 
	

Sku.containedInEntitlementLineItems = \
	select entitlementlineitem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementProductBO as entitlementlineitem \
	inner join entitlementlineitem.sku_ as sku \
	where sku.id= ? AND entitlementlineitem.tenantId_=:tenantId
		
LicenseModel.containedInEntitlementLineItems = \
	select entitlementlineitem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementProductBO as entitlementlineitem \
	inner join entitlementlineitem.licenseModel_ as licensemodel \
	where licensemodel.id= ? AND entitlementlineitem.tenantId_=:tenantId
	
LicenseModel.containedInNonTestEntitlementLineItems = \
	select entitlement \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join entProduct.licenseModel_ as licensemodel \
	where licensemodel.id= ? and entitlement.status_ != 'bo.constants.states.test' AND entitlement.tenantId_=:tenantId
	
ActivatableItem.childLineItems = \
	select childItem from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as childItem \
	where childItem.parentLineItem_.id = ?  AND childItem.tenantId_=:tenantId

ActivatableItemBO.getByParent=\
SELECT obj FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
	inner join obj.parentEntitlement_ as parentEntitlement \
	where parentEntitlement.id = ? and obj.activatableItemType = ? AND obj.tenantId_=:tenantId
	
ActivatableItem.childLineItemsBySupport = \
	select childItem from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as childItem \
	inner join childItem.parentLineItem_ as parentLineItem \
	where parentLineItem.id = ? and childItem.supportAction_ = ? AND childItem.tenantId_=:tenantId

ActivatableItem.rootLineItems = \
	select childItem from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as childItem \
	inner join childItem.parentEntitlement_ as parentEntitlement \
	where childItem.parentLineItem_ is null and parentEntitlement.id = ? AND childItem.tenantId_=:tenantId  and parentEntitlement.tenantId_=:tenantId

ActivationInstance.childFulfillments = \
	select childItem from \
	com.flexnet.operations.bizobjects.ActivationInstance as childItem \
	inner join childItem.parentFulfillment as parentFulfillment \
	where parentFulfillment.id = ?  AND childItem.tenantId_=:tenantId

ActivationInstance.rootFulfillments = \
	select childItem from \
	com.flexnet.operations.bizobjects.ActivationInstance as childItem \
	inner join childItem.entitlementLineItem as entitlementLineItem \
	where childItem.parentFulfillment is null and entitlementLineItem.id = ? AND childItem.tenantId_=:tenantId

ActivatableItem.allRootLineItems = \
 	select item from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as item \
	where item.parentLineItem_ is null  AND item.tenantId_=:tenantId

EntitlementLineItemBO.getFulfillments = \
	select fulfillment from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem entitlmentLineItem \
	where entitlmentLineItem.id = ?  AND fulfillment.tenantId_=:tenantId AND entitlmentLineItem.tenantId_=:tenantId
	
ActivatableItem.lineItemsByState = \
	select childItem from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as childItem \
	inner join childItem.parentEntitlement_ parentEntitlement \
	where parentEntitlement.id = ? and childItem.status_ = ? AND childItem.tenantId_=:tenantId AND parentEntitlement.tenantId_=:tenantId
	
ActivatableItem.lineItemsByStateList = \
	select childItem from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as childItem \
	inner join childItem.parentEntitlement_ parentEntitlement \
	where parentEntitlement.id = ? and childItem.status_ in (:state) AND childItem.tenantId_=:tenantId AND parentEntitlement.tenantId_=:tenantId
	
MaintenanceItem.lineItemsByNotState = \
	select maintItem from \
	com.flexnet.operations.bizobjects.MaintenanceItemDO as maintItem \
	inner join maintItem.parentEntitlement_ parentEntitlement \
	where parentEntitlement.id = ? and maintItem.status_ != ? AND maintItem.tenantId_=:tenantId AND parentEntitlement.tenantId_=:tenantId

MaintenanceItem.lineItemsByState = \
	select maintItem from \
	com.flexnet.operations.bizobjects.MaintenanceItemDO as maintItem \
	inner join maintItem.parentEntitlement_ parentEntitlement \
	where parentEntitlement.id = ? and maintItem.status_ = ? AND maintItem.tenantId_=:tenantId AND parentEntitlement.tenantId_=:tenantId
#
# Recently accessed queries
#

RecentlyAccessed.deleteItem=\
	delete from PROD_RECENTLY_USED where ITEM_TYPE=? and ITEM_ID=? AND TENANT_ID=:tenantId

#XXXXXcom.flexnet.operations.bizobjects.Entitlement not there any more
# Entitlement.getRecentlyAccessed=\
#	select entitlement \
#	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
#	from com.flexnet.operations.bizobjects.Entitlement as entitlement \
#	where entitlement.id=ra.itemId and ra.type='com.flexnet.operations.bizobjects.Entitlement' \
#	and ra.changedBy=?
###XXXXXcom.flexnet.operations.bizobjects.Entitlement not there any more
#Entitlement.getRecentlyAccessedCount=\
#	select count(*) \
#	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
#	from com.flexnet.operations.bizobjects.Entitlement as entitlement \
#	where entitlement.id=ra.itemId and ra.type='com.flexnet.operations.bizobjects.Entitlement' \
#	and ra.changedBy=?
Entitlement.updateLastModifiedDate = \
    update OPS_ENTITLEMENT_ORDER set CREATED_ON=?, LAST_MODIFIED=?, AUDIT_UPDATEDBY=? where ID=? and CREATED_ON < ?

ActivatableItem.updateLastModifiedDate = \
    update OPS_ACTIVATABLE_ITEM set LAST_MODIFIED=GETUTCDATE() where TENANT_ID=? and ACTIVATION_ID=?

ActivatableItem.setTransferStartById = \
    update OPS_ACTIVATABLE_ITEM set TRANSFER_START=GETUTCDATE() where TENANT_ID=? and ID=?

ActivatableItem.setTransferStartByActivationId = \
    update OPS_ACTIVATABLE_ITEM set TRANSFER_START=GETUTCDATE() where TENANT_ID=? and ACTIVATION_ID=?

ActivatableItem.resetTransferStartById = \
    update OPS_ACTIVATABLE_ITEM set TRANSFER_START=NULL where TENANT_ID=? and ID=?

ActivatableItem.resetTransferStartByActivationId = \
    update OPS_ACTIVATABLE_ITEM set TRANSFER_START=NULL where TENANT_ID=? and ACTIVATION_ID=?

ActivationInstance.getRecentlyAccessed=\
	select instance \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	from com.flexnet.operations.bizobjects.ActivationInstance as instance \
	where instance.id=ra.itemId and ra.type='com.flexnet.operations.bizobjects.ActivationInstance' \
	and ra.changedBy=? AND ra.tenantId_=:tenantId AND instance.tenantId_=:tenantId 

ActivationInstance.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	from com.flexnet.operations.bizobjects.ActivationInstance as instance \
	where instance.id=ra.itemId and ra.type='com.flexnet.operations.bizobjects.ActivationInstance' \
	and ra.changedBy=? AND ra.tenantId_=:tenantId AND instance.tenantId_=:tenantId 

	

#
# Alerts
#
Alerts.emailsToBePurged= select email.id from com.flexnet.operations.bizobjects.administer.EmailHistoryBO as email where email.lastModified <? and tenantId \= ? and status = 'SENT'  AND email.tenantId=:tenantId

Alerts.changedProductsByFeatures = select lp from \
com.flexnet.products.bizobjects.LicensedProduct as lp inner join \
lp.licensedItems as licItems inner join licItems.bundle.bundleItems as fitems \
where lp.tenantId_=:tenantId AND ( licItems.bundle.auditInfo.updatedOn > ? or \
fitems.feature.auditInfo.updatedOn>? ) \
  group by lp


Alerts.changedProductIdsByFeatures = select distinct lp.id as id, lp.name_ as name_, lp.version_ as version_, lp.orderableType as orderableType, lp.status_ as status from \
com.flexnet.products.bizobjects.LicensedProduct as lp inner join \
lp.licensedItems as licItems inner join licItems.bundle.bundleItems as fitems \
where lp.tenantId_=:tenantId AND ( licItems.bundle.auditInfo.updatedOn > :lastUpdated or \
fitems.feature.auditInfo.updatedOn > :lastUpdated ) 

Alerts.changedProducts = select lp from \
com.flexnet.products.bizobjects.LicensedProduct as lp \
where lp.auditInfo.updatedOn >? AND lp.tenantId_=:tenantId

Alerts.changedProductIds = select distinct lp.id as id, lp.name_ as name_, lp.version_ as version_, lp.orderableType as orderableType, lp.status_ as status from \
com.flexnet.products.bizobjects.LicensedProduct as lp \
where lp.auditInfo.updatedOn > :lastUpdated AND lp.tenantId_=:tenantId


Alerts.availableUpgradeFromProducts = select relatedProd.id, lp  from \
com.flexnet.products.bizobjects.LicensedProduct as lp \
inner join lp.relatedOrderables lpUpgrades \
inner join lpUpgrades.relatedOrderable relatedProd \
where lpUpgrades.relationType='bo.constants.orderable.relationType.upgradeFrom' \
and (lp.startDate is null OR lp.startDate <= :currentDate) \
and (lp.endDate is null OR lp.endDate >= :currentDate) \
and lp.status_='bo.constants.states.deployed' AND lp.tenantId_=:tenantId


Alerts.getMaintenanceProductIds = select mp.id from \
com.flexnet.products.bizobjects.Maintenance as mp \
inner join mp.relatedOrderables relatedProducts \
inner join relatedProducts.relatedOrderable fromToProducts \
where relatedProducts.relationType='bo.constants.orderable.relationType.isMaintenance' \
and fromToProducts.id=(:productId) AND mp.tenantId_=:tenantId


Alerts.changedSuites = select suite from \
com.flexnet.products.bizobjects.UniformSuite as suite \
where suite.auditInfo.updatedOn >? AND suite.tenantId_=:tenantId

Alerts.changedSuitesProduct = select suite.suiteItems.licensedProduct.id from \
				com.flexnet.products.bizobjects.UniformSuite as suite \
				where suite.suiteItems = :suiteId  AND suite.tenantId_=:tenantId
				
Alerts.changedSuiteIds = select distinct suite.id  as id, suite.name_ as name_, suite.version_ as version_, suite.orderableType as orderableType, suite.status_ as status from \
com.flexnet.products.bizobjects.UniformSuite as suite \
where suite.auditInfo.updatedOn > :lastUpdated AND suite.tenantId_=:tenantId

Alerts.changedProductFeatures = select feature.id as id, feature.name_ as name, feature.version_ as version from \
com.flexnet.products.bizobjects.LicensedProduct as lp \
inner join lp.licensedFeatures as licFeatures \
inner join licFeatures.feature as feature \
where lp.id=:id and feature.auditInfo.updatedOn > :lastUpdated AND lp.tenantId_=:tenantId


Alerts.changedProductFeatureBundles = select bundle.id as id, bundle.name_ as name from \
com.flexnet.products.bizobjects.LicensedProduct as lp \
inner join lp.licensedItems as licItems \
inner join licItems.bundle as bundle \
where (bundle.auditInfo.updatedOn > :lastUpdated) \
and lp.id=:id  AND lp.tenantId_=:tenantId 

Alerts.changedProductBundledFeatures = select feature.id as id, feature.name_ as name, feature.version_ as version from \
com.flexnet.products.bizobjects.LicensedProduct as lp \
inner join lp.licensedItems as licItems \
inner join licItems.bundle as bundle \
inner join bundle.bundleItems as fitems \
inner join fitems.feature as feature \
where (feature.auditInfo.updatedOn > :lastUpdated) and lp.id=:id AND lp.tenantId_=:tenantId

#XXXXX UN-Used
#Alerts.expiringESN=select esn \
#from com.flexnet.operations.bizobjects.Esn as esn \
#inner join esn.entitlements_ as ent \
#where (esn.esnType_='bo.constants.esn.type.simple' or \
#esn.esnType_='bo.constants.esn.type.bulk') \
#and ent.validUntil_<? \
# AND esn.null=:tenantId group by esn
#XXXXX UN-Used
#Alerts.expiringEntitlements= select ent \
#from com.flexnet.operations.bizobjects.Esn as esn \
#inner join esn.entitlements_ as ent \
#where (esn.esnType_='bo.constants.esn.type.simple' or \
#esn.esnType_='bo.constants.esn.type.bulk') \
#and ent.validUntil_<? and esn.esn_=? AND esn.null=:tenantId

Alerts.allOperationsAlertsByType = \
    select alert \
    from com.flexnet.platform.entities.Alert alert \
    inner join alert.alertType as alertType \
    where alertType.type \= \:alertType \
    and alertType.template is null AND alert.tenantId_=:tenantId

TrustedKeyConfiguration.getProduct= \
select keys from TrustedKeyConfiguration as keys \
inner join keys.products as product \
where product.id = ? AND keys.tenantId_=:tenantId

TrustedKeyConfiguration.getActivationSpecs = \
select specs from ActivationSpecification as specs \
inner join specs.trustedKey as key \
where key.id = ? AND specs.tenantId_=:tenantId

TrustedKeyConfiguration.getMaxId=SELECT MAX(TRUSTED_ID) from OPS_TRUSTED_KEY_CONFIGURATION WHERE PUBLISHER_ID=? AND TENANT_ID=:tenantId

TrustedKeyConfiguration.getAllIds=SELECT TRUSTED_ID from OPS_TRUSTED_KEY_CONFIGURATION WHERE PUBLISHER_ID=? AND TENANT_ID=:tenantId ORDER BY TRUSTED_ID ASC


LocalTrialSpecification.getMaxTrialId = SELECT MAX(specs.trialId) as maxTrialId from com.flexnet.operations.trusted.LocalTrialSpecification as specs \
inner join  specs.trustedKey as trustedKey \
where trustedKey.publisherId=? AND specs.tenantId_=:tenantId

LocalTrialSpecification.getTrialIdCount = SELECT count(specs.trialId) as maxTrialId from com.flexnet.operations.trusted.LocalTrialSpecification as specs \
inner join  specs.trustedKey as trustedKey \
where trustedKey.publisherId=? AND specs.tenantId_=:tenantId

LocalTrialSpecification.getAllTrialId = SELECT specs from com.flexnet.operations.trusted.LocalTrialSpecification as specs \
inner join  specs.trustedKey as trustedKey \
where trustedKey.publisherId=?  AND specs.tenantId_=:tenantId order by specs.trialId ASC

RequestTransaction.getPendingAsyncRequests=\
	select request from com.flexnet.operations.trusted.RequestTransaction as request \
	where request.status='ASYNC_CONNECT'  AND request.tenantId_=:tenantId order by request.createdOn

RequestTransaction.getRequest=\
	select request from com.flexnet.operations.trusted.RequestTransaction as request \
	where request.activationId=? and request.machineBinding=? AND request.tenantId_=:tenantId

RequestTransaction.getFulfilledRequest=\
	select request from com.flexnet.operations.trusted.RequestTransaction as request \
	where request.fulfillmentId=? and request.machineBinding like ? AND request.tenantId_=:tenantId

RequestTransaction.getTrustedRequest=\
	select request from com.flexnet.operations.trusted.RequestTransaction as request \
	inner join request.requestItems reqItem \
	where reqItem.fulfillmentId=? and reqItem.requestType = ?  AND request.tenantId_=:tenantId


Processor.getTrustedActivationInstance=\
	select instance from com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	where lineItem.activationID_=? and \
	(hostEntity.umnType1.hostId=? or hostEntity.umnType2.hostId=? or hostEntity.machineIdentifier.hostId=?) and \
	instance.status_=? AND instance.tenantId_=:tenantId

Processor.getTrustedActivationInstanceForSC=\
	select instance from com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	where lineItem.activationID_=? and \
	(hostEntity.umnType1.hostId like ? or hostEntity.umnType2.hostId like ? or hostEntity.machineIdentifier.hostId like ?) and \
	instance.status_=? AND instance.tenantId_=:tenantId

TrustedConfigHistory.getTrustedConfigsForTrustedKey=\
    select trustedConfig from TrustedConfiguration  as trustedConfig \
    where trustedConfig.trustedID=?  AND trustedConfig.tenantId_=:tenantId order by auditInfo.updatedOn desc	

TrustedConfig.getConfigByTrustedId=\
    select trustedConfig from TrustedConfiguration as trustedConfig \
    inner join trustedConfig.trustedID as trustedKeyConfig \
    where trustedKeyConfig.trustedID_= :trustedId \
          AND trustedConfig.alternateID= :alternateId \
          AND trustedKeyConfig.tenantId_=:tenantId \
          AND trustedConfig.tenantId_=:tenantId
#
# Policy queries
#
FulfillmentHistory.getNumReturnsQuery=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	where hist.lineItemID_=? and hist.action_='bo.constants.fulfillmentAction.returned' and hist.createdOn >= ? and hist.createdOn <= ? AND hist.tenantId_=:tenantId

FulfillmentHistory.getNumRehostsQuery=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	where hist.lineItemID_=? and hist.action_='bo.constants.fulfillmentAction.rehosted' and hist.createdOn >= ? and hist.createdOn <= ? AND hist.tenantId_=:tenantId

FulfillmentHistory.getNumRepairsQuery=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	where hist.lineItemID_=? and hist.action_='bo.constants.fulfillmentAction.repaired' and hist.createdOn >= ? and hist.createdOn <= ? AND hist.tenantId_=:tenantId
	
FulfillmentHistory.getNumActivationsQuery=\
	select sum(hist.count_) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	where hist.lineItemID_=? and hist.action_='bo.constants.fulfillmentAction.activated' AND hist.tenantId_=:tenantId
	
FulfillmentHistory.getFulfillmentHistoryForLineItem = \
 	select fulfillHistory from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as fulfillHistory \
	where fulfillHistory.lineItemID_ = ? \
	 AND fulfillHistory.tenantId_=:tenantId order by fulfillHistory.createdOn

FulfillmentHistory.deleteFulfillmentHistoryForLineItemById = \
   DELETE FROM FulfillmentHistoryBO WHERE lineItemID_ = ? AND TENANT_ID=:tenantId
	
FulfillmentHistory.getFulfillmentHistoryCountForLineItem = \
 	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as fulfillHistory \
	where fulfillHistory.lineItemID_ = ? \
	 AND fulfillHistory.tenantId_=:tenantId order by fulfillHistory.createdOn

FulfillmentHistory.getNumReinstallsQuery=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	where hist.lineItemID_=? and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? AND hist.tenantId_=:tenantId
	
EntitlementTemplates.getEntitlementsTemplates =\
    select  emp_template from com.flexnet.operations.bizobjects.administer.EmailTemplateBO as emp_template inner join \
    com.flexnet.operations.bizobjects.administer.EmailEventBO as email_event_temp on emp_template.email_event_id = email_event_temp.email_event_id \
    where email_event_temp.email_event_nm ='Entitlement' \
    and emp_template.tenant_id =:tenant_id \
    and (emp_template.email_tpl_ver_id is not null and emp_template.snd_ind >0)
    
    

FulfillmentHistory.getNumReinstallsForUmn1Query=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.umnType1 as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId = ? AND hist.tenantId_=:tenantId

FulfillmentHistory.getNumReinstallsForUmn2Query=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.umnType2 as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId = ? AND hist.tenantId_=:tenantId

FulfillmentHistory.getNumReinstallsForMIdQuery=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.machineIdentifier as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId = ? AND hist.tenantId_=:tenantId

FulfillmentHistory.getNumReinstallsForUmn3Query=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.umnType3 as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId = ? AND hist.tenantId_=:tenantId
	
FulfillmentHistory.shortcode.getNumReinstallsForUmn1Query=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.umnType1 as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId like ? AND hist.tenantId_=:tenantId

FulfillmentHistory.shortcode.getNumReinstallsForUmn2Query=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.umnType2 as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId like ? AND hist.tenantId_=:tenantId

FulfillmentHistory.shortcode.getNumReinstallsForMIdQuery=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.machineIdentifier as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId like ? AND hist.tenantId_=:tenantId
	
	
FulfillmentHistory.shortcode.getNumReinstallsForUmn3Query=\
	select count(*) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as hist \
	inner join hist.fulfillmentId_ as instance \
	inner join instance.hostEntity as hostEntity \
	left outer join hostEntity.umnType3 as hostUnit \
	where hist.lineItemID_=? \
	and hist.action_='bo.constants.fulfillmentAction.reinstalled' \
	and hist.createdOn >= ? and hist.createdOn <= ? \
	and hostUnit.hostId like ? AND hist.tenantId_=:tenantId

ActivationSpecification.getLocalSpecsByOrderable=\
	select spec from com.flexnet.operations.trusted.LocalTrialSpecification as spec \
	inner join spec.orderable_ orderable \
	where orderable.name_=? AND orderable.version_=? AND spec.tenantId_=:tenantId

ActivationSpecification.getShortCodeSpecsByOrderable=\
	select spec from com.flexnet.operations.trusted.ShortCodeSpecification as spec \
	where spec.orderable_.name_=? AND spec.orderable_.version_=? AND spec.tenantId_=:tenantId

ActivationSpecification.getAllShortCodeSpecs=\
	select spec from com.flexnet.operations.trusted.ShortCodeSpecification as spec  WHERE spec.tenantId_=:tenantId
	
	
ShipmentRecord.getShipmentRecords = \
 	select shipmentRecord from \
	com.flexnet.operations.bizobjects.ShipmentRecordBO as shipmentRecord \
	left outer join shipmentRecord.fulfillmentId_ as fulfill \
	left outer join shipmentRecord.consolidatedLicenseId_ as conLic \
	left outer join conLic.consolidatedFulFillments as conFul \
	left outer join conFul.fulfillment as ful \
	where fulfill.fulfillmentId= ? \
	or ful.fulfillmentId = ? AND shipmentRecord.tenantId_=:tenantId
	
ShipmentRecord.getConsolidatedLicenseShipmentRecords = \
 	select shipmentRecord from \
	com.flexnet.operations.bizobjects.ShipmentRecordBO as shipmentRecord \
	inner join shipmentRecord.consolidatedLicenseId_ as conLic \
	where conLic.consolidatedLicId= ? \
	 AND shipmentRecord.tenantId_=:tenantId order by shipmentRecord.createdOn
	
ShipmentRecord.getShipmentRecordsIdsForLineItem = \
select distinct shipmentRecord.id from \
	com.flexnet.operations.bizobjects.ShipmentRecordBO as shipmentRecord \
	left outer join shipmentRecord.fulfillmentId_ as fulfill \
	left outer join fulfill.entitlementLineItem as eli \
	left outer join shipmentRecord.consolidatedLicenseId_ as conLic \
	left outer join conLic.consolidatedFulFillments as conFul \
	left outer join conFul.fulfillment as ful \
	left outer join ful.entitlementLineItem as eli2 \
	where eli.id = ? \
	or eli2.id = ? AND shipmentRecord.tenantId_=:tenantId
	
ActivatableItemBO.getWorkItemsForTargetLineItem = \
select workitem from \
	 com.flexnet.operations.services.bulkOperations.WorkItemDO as workitem \
	where workitem.entitlementLineItemTo_ = ? AND workitem.tenantId_=:tenantId

ActivatableItemBO.getWorkItemsForSourceLineItem = \
select workitem from \
	com.flexnet.operations.services.bulkOperations.WorkItemDO as workitem \
	where workitem.entitlementLineItemFrom_ = ? AND workitem.tenantId_=:tenantId
	
Consolidations.getConsolidationsForLineitem = \
select distinct conLic from \
com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
inner join conLic.consolidatedFulFillments as conFul \
inner join conFul.fulfillment as ful \
inner join ful.entitlementLineItem as eli \
where eli.id = ? AND conLic.tenantId_=:tenantId

StateChangeHistory.getStateChangeHistoryForItem= \
 	select stateChangeHistory from \
	com.flexnet.products.bizobjects.StateChangeHistoryBO as stateChangeHistory \
	where stateChangeHistory.objectId_ = ? \
	and stateChangeHistory.objectClass_ = ? \
	 AND stateChangeHistory.tenantId_=:tenantId order by stateChangeHistory.createdOn
	
ActivationInstance.getActiveFulfillmentRecordsByHost = \
    select instance from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as ent \
    inner join instance.hostEntity as h \
    where h.id = ? \
  	and (instance.expirationDate is null OR instance.expirationDate >= ?) \
	and instance.lifeCycleStatus_ is null \
	and instance.status_ = 'bo.constants.states.active' \
	and instance.vendorDaemonName_ = ? AND instance.tenantId_=:tenantId
    	
ActivationInstance.getFulfilledCopiesByHost = \
	select sum(instance.fulfillmentCount) from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as ent \
    inner join instance.hostEntity as h \
    inner join ent.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
    and lineitem.id = ? and soldTo.id = ? and h.id = ? \
	and (instance.lifeCycleStatus_ is null OR \
	instance.lifeCycleStatus_ NOT IN ('bo.constants.lifecycle.status.stopgap', 'bo.constants.lifecycle.status.emergency')) \
	and instance.status_ = 'bo.constants.states.active' AND instance.tenantId_=:tenantId
	 
ActivationInstance.getParentFulfillmentRecordsByHost = \
	select instance from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as ent \
    inner join instance.hostEntity as h \
    inner join ent.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
    and lineitem.id = ? and soldTo.id = ? and h.id = ? \
	and (instance.lifeCycleStatus_ is null OR \
	instance.lifeCycleStatus_ NOT IN ('bo.constants.lifecycle.status.stopgap', 'bo.constants.lifecycle.status.emergency')) \
	and instance.status_ = 'bo.constants.states.active'  AND instance.tenantId_=:tenantId

ActivationInstance.getLineItemsByHost = \
	select distinct lineitem from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
 	inner join lineitem.entitledOrderableSet as entOrderableSet \
   inner join instance.licenseModel_ as licenseModel \
    inner join lineitem.parentEntitlement_ as entitlement \
    inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
    and soldTo.name_ = ? and host.id = ? and entOrderableSet.productIdsCount = ? \
    and licenseModel.name = ? and instance.expirationDate = ? and \
    instance.fulfillmentType = 'bo.constants.fulfillment.type.certificate' \
    and instance.status_ = 'bo.constants.states.active' AND instance.tenantId_=:tenantId

ActivationInstance.getPermanentLineItemsByHost = \
	select distinct lineitem from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
 	inner join lineitem.entitledOrderableSet as entOrderableSet \
    inner join instance.licenseModel_ as licenseModel \
    inner join lineitem.parentEntitlement_ as entitlement \
    inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.name_ = ? and host.id = ? and entOrderableSet.productIdsCount = ? \
    and licenseModel.name = ? and instance.expirationDate is null and \
    instance.fulfillmentType = 'bo.constants.fulfillment.type.certificate' \
    and instance.status_ = 'bo.constants.states.active' AND instance.tenantId_=:tenantId

ActivationInstance.getAllCertificateLineItemsForHost = \
	select distinct lineitem from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as entitlement \
    inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
    and soldTo.name_ = ? and host.id = ? \
    and instance.fulfillmentType = 'bo.constants.fulfillment.type.certificate' \
    and instance.status_ = 'bo.constants.states.active' AND instance.tenantId_=:tenantId

ActivationInstance.getCountOfAllCertificateLineItemsForHost = \
	select count (distinct lineitem) from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as entitlement \
    inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
    and soldTo.name_ = ? and host.id = ? \
    and instance.fulfillmentType = 'bo.constants.fulfillment.type.certificate' \
    and instance.status_ = 'bo.constants.states.active' AND instance.tenantId_=:tenantId

HostEntityBO.getOrphanHost= \
	select host from \
	com.flexnet.operations.bizobjects.HostEntityBO as host \
	where host.id = ? \
	and host NOT IN \
		(select host \
		from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as act \
		inner join act.hostIds_ as ehost \
		inner join ehost.host as host) \
	and host NOT IN \
		(select instance.hostEntity from com.flexnet.operations.bizobjects.ActivationInstance as instance) AND instance.tenantId_=:tenantId

HostEntityBO.getFulfillmentsForHost = \
select instance \
from com.flexnet.operations.bizobjects.ActivationInstance as instance \
inner join instance.hostEntity as host \
where host.id = ? AND instance.tenantId_=:tenantId

HostEntityBO.getActivatableItemsForHost = \
select act \
from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as act \
inner join act.hostIds_ as ehost \
inner join ehost.host as host \
where host.id = ? AND act.tenantId_=:tenantId

EntitlementBO.getUpgradeUpsellProducts = \
select orderable \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.relatedOrderables as item \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and item.relationType IN (?, ?) \
	and entitlement.status_ = ?  AND entitlement.tenantId_=:tenantId

EntitlementBO.getUpgradeUpsellProductsCount = \
select count (distinct orderable) \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.relatedOrderables as item \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and item.relationType IN (?, ?) \
	and entitlement.status_ = ? AND entitlement.tenantId_=:tenantId
	
	 
OrgUnit.getUsers = SELECT obj FROM com.flexnet.platform.bizobjects.User AS obj JOIN obj.contactInfo_ AS contactInfo \
					JOIN obj.contactInfo_.belongsTo_  AS orgContact JOIN orgContact.orgUnitId_ as belongsTo where obj.phantom_ = 0 \
					AND belongsTo.id=? AND obj.tenantId_=:tenantId
OrgUnit.getUsersCount = SELECT count(*) FROM com.flexnet.platform.bizobjects.User AS obj JOIN obj.contactInfo_ AS contactInfo \
					JOIN obj.contactInfo_.belongsTo_ AS orgContact JOIN orgContact.orgUnitId_ as belongsTo where obj.phantom_ = 0 \
					AND belongsTo.id=? AND obj.tenantId_=:tenantId
OrgUnit.getUsersByPermissions = SELECT DISTINCT obj FROM com.flexnet.platform.bizobjects.User AS obj \
								inner join obj.OrgUnitRoles_ as orgUnitRoles with obj.tenantId_=orgUnitRoles.tenantId_ \
								inner join orgUnitRoles.role as roles with orgUnitRoles.tenantId_=roles.tenantId_ \
								inner join roles.grants_ as rolePermission with rolePermission.tenantId_=roles.tenantId_ \
								inner join rolePermission.grantedBy_ as permissions \
								where obj.phantom_ = 0 AND orgUnitRoles.orgUnit=?1 AND permissions.name_ = ?2 AND obj.tenantId_=?3 AND obj.active_ = 1
OrgUnit.getUsersCountByPermission = SELECT count(DISTINCT obj) FROM com.flexnet.platform.bizobjects.User AS obj \
								inner join obj.OrgUnitRoles_ as orgUnitRoles with obj.tenantId_=orgUnitRoles.tenantId_ \
								inner join orgUnitRoles.role as roles with orgUnitRoles.tenantId_=roles.tenantId_ \
								inner join roles.grants_ as rolePermission with rolePermission.tenantId_=roles.tenantId_ \
								inner join rolePermission.grantedBy_ as permissions \
								where obj.phantom_ = 0 AND orgUnitRoles.orgUnit=?1 AND permissions.name_ = ?2 AND obj.tenantId_=?3 AND obj.active_ = 1
								
Contact.getExistingUsersHosted = SELECT user FROM com.flexnet.platform.bizobjects.User as user JOIN user.contactInfo_ AS contactInfo \
									    where user.userId_ \= ? and contactInfo.email_ \=? AND user.tenantId_=:tenantId

Contact.getExistingUsersOnPrem = SELECT user FROM com.flexnet.platform.bizobjects.User as user JOIN user.contactInfo_ AS contactInfo \
									    where user.userId_ \= ?   AND user.tenantId_=:tenantId

EntitlementBO.getProductsBySoldTo = \
select distinct orderable \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and entitlement.status_ = ?  AND entitlement.tenantId_=:tenantId

EntitlementBO.getProductsBySoldToCount = \
select count (distinct orderable) \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and entitlement.status_ = ? AND entitlement.tenantId_=:tenantId

EntitlementLineItem.getByActivationIds = SELECT obj \
    FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
    WHERE  obj.activationID_ IN (:activationIDs) AND obj.tenantId_ = :tenantId \
    ORDER BY  obj.id ASC

EntitlementLineItem.getByActivationIdsWithJoins = SELECT obj \
    FROM com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO AS obj \
    LEFT JOIN FETCH obj.entitlementProduct_ \
    LEFT JOIN FETCH obj.entitlementPolicies_ \
	LEFT JOIN FETCH obj.entitledOrderableSet AS os \
  	LEFT JOIN FETCH os.entitledOrderables_ \
	INNER JOIN FETCH obj.parentEntitlement_ AS ent \
	LEFT JOIN FETCH ent.channelPartnerSet AS cps \
	LEFT JOIN FETCH cps.channelPartners_ AS cp  \
    LEFT JOIN FETCH cp.partnerTier_ \
    WHERE  obj.activationID_ IN (:activationIDs) AND obj.tenantId_ = :tenantId \
    ORDER BY  obj.id ASC

EntitlementLineItem.getParentActivationId = \
	WITH ACTID_CHAIN ( ID, PARENT_LINE_ITEM, ACTIVATION_ID, SUPPORT_ACTION, tenant_id, LEVEL ) AS \
    ( \
         SELECT a.ID,  a.PARENT_LINE_ITEM,  a.ACTIVATION_ID,  a.SUPPORT_ACTION,  a.tenant_id,  0 as LEVEL \
           FROM OPS_ACTIVATABLE_ITEM a \
          where activation_id    = :actId \
            and a.support_action = :supportAction \
            and a.tenant_id      = :tenantId \
         UNION ALL \
         SELECT b.ID,  b.PARENT_LINE_ITEM,  b.ACTIVATION_ID,  b.SUPPORT_ACTION,  b.tenant_id,  LEVEL+1 as LEVEL \
           FROM OPS_ACTIVATABLE_ITEM   b  \
          INNER JOIN   ACTID_CHAIN  c   ON c.PARENT_LINE_ITEM  =  b.id  \
          AND c.tenant_id =  b.tenant_id and c.SUPPORT_ACTION =  :supportAction \
    ) \
	SELECT  ACTIVATION_ID FROM ACTID_CHAIN WHERE  LEVEL > 0 \
	ORDER by LEVEL DESC

EntitlementLineItem.getBaseActivations = \
  SELECT ID, PARENT_LINE_ITEM AS [PARENT_ID], ACTIVATION_ID, RETAIN_PARENT_LINE_ITEM \
  FROM OPS_ACTIVATABLE_ITEM WITH (NOLOCK) \
  WHERE TENANT_ID = :tenantId AND ACTIVATION_ID IN (:ids)

EntitlementLineItem.getChildActivations = \
  SELECT ID, PARENT_LINE_ITEM AS [PARENT_ID], ACTIVATION_ID, RETAIN_PARENT_LINE_ITEM \
  FROM OPS_ACTIVATABLE_ITEM WITH (NOLOCK) \
  WHERE TENANT_ID = :tenantId AND PARENT_LINE_ITEM IN (:ids)

EntitlementLineItem.getActivationForID = \
  SELECT ID , ACTIVATION_ID  \
  FROM OPS_ACTIVATABLE_ITEM WITH (NOLOCK) \
  WHERE TENANT_ID = :tenantId AND ID IN (:ids)

EntitlementLineItem.getActivations = \
  WITH ACTIVATABLE_ITEM_CTE \
  (\
    <#if config.countOnly()> \
    ID, TENANT_ID, ENTITLED_ORDERABLES \
    <#else> \
    ID, TENANT_ID, \
    PARENT_ENTITLEMENT_ID, \
    ENTITLED_ORDERABLES, \
    ACTIVATABLE_ITEM_TYPE, \
    SUPPORT_ACTION, ACTIVATION_ID, \
    CREATED_ON, LAST_MODIFIED, \
    AUDIT_CREATEDBY, AUDIT_UPDATEDBY, \
    [STATUS], SEAT_COUNT, \
    FULFILLED_AMOUNT, \
    AVAILABLE_REALLOCATION_COUNT, \
    ORDER_ID, \
    ORDER_LINE_NUMBER, \
    MAINTENANCE_EXPIRATION_DATE, \
    REMAINING_COPIES, \
    IS_PERMANENT, \
    VALID_UNTIL, \
    DURATION, \
    DURATION_UNITS, \
    START_DATE_OPTIONS, \
    VALID_AFTER, \
    VERSION_DATE, \
    VERSION_DATE_OPTIONS, \
    VERSION_DATE_DURATION, \
    VERSION_DATE_DUR_UNITS, \
    [DESCRIPTION], \
    LICENSEMODEL_ID, \
    ALT_LICENSEMODEL1_ID, \
    ALT_LICENSEMODEL2_ID, \
    IS_BULK_LINE_ITEM, \
    EO_SEAT_COUNT, \
    EO_ID, \
    CHANNEL_PARTNER_SET, \
    EO_TENANT_ID, \
    ENTITLEMENT_ID, \
    COMMENTS, \
    SHIP_TO_EMAIL, \
    SHIP_TO_ADDRESS, \
    ALLOW_PORTAL_LOGIN, \
    EO_STATUS \
    </#if> \
  ) \
  AS ( \
    SELECT \
    <#if config.countOnly()> \
    ai.ID AS ID, ai.TENANT_ID AS TENANT_ID, ai.ENTITLED_ORDERABLES AS ENTITLED_ORDERABLES \
    <#else> \
    ai.ID AS ID, ai.TENANT_ID AS TENANT_ID, \
    ai.PARENT_ENTITLEMENT_ID AS PARENT_ENTITLEMENT_ID, \
    ai.ENTITLED_ORDERABLES AS ENTITLED_ORDERABLES, \
    ai.ACTIVATABLE_ITEM_TYPE AS ACTIVATABLE_ITEM_TYPE, \
    ai.SUPPORT_ACTION AS SUPPORT_ACTION, \
    ai.ACTIVATION_ID AS ACTIVATION_ID, \
    ai.CREATED_ON AS CREATED_ON, \
    ai.LAST_MODIFIED AS LAST_MODIFIED, \
    ai.AUDIT_CREATEDBY AS AUDIT_CREATEDBY, \
    ai.AUDIT_UPDATEDBY AS AUDIT_UPDATEDBY, \
    ai.[STATUS] AS [STATUS], \
    ai.SEAT_COUNT AS SEAT_COUNT, \
    ai.FULFILLED_AMOUNT AS FULFILLED_AMOUNT, \
    ai.AVAILABLE_REALLOCATION_COUNT AS AVAILABLE_REALLOCATION_COUNT, \
    ai.ORDER_ID AS ORDER_ID, \
    ai.ORDER_LINE_NUMBER AS ORDER_LINE_NUMBER, \
    ai.MAINTENANCE_EXPIRATION_DATE AS MAINTENANCE_EXPIRATION_DATE, \
    e.REMAINING_COPIES AS REMAINING_COPIES, \
    e.IS_PERMANENT AS IS_PERMANENT, \
    e.VALID_UNTIL AS VALID_UNTIL, e.DURATION AS DURATION, \
    e.DURATION_UNITS AS DURATION_UNITS, \
    e.START_DATE_OPTIONS AS START_DATE_OPTIONS, \
    e.VALID_AFTER AS VALID_AFTER, \
    e.VERSION_DATE AS VERSION_DATE, \
    e.VERSION_DATE_OPTIONS AS VERSION_DATE_OPTIONS, \
    e.VERSION_DATE_DURATION AS VERSION_DATE_DURATION, \
    e.VERSION_DATE_DUR_UNITS AS VERSION_DATE_DUR_UNITS, \
    e.[DESCRIPTION] AS [DESCRIPTION], \
    e.LICENSEMODEL_ID AS LICENSEMODEL_ID, \
    e.ALT_LICENSEMODEL1_ID AS ALT_LICENSEMODEL1_ID, \
    e.ALT_LICENSEMODEL2_ID AS ALT_LICENSEMODEL2_ID, \
    ai.IS_BULK_LINE_ITEM AS IS_BULK_LINE_ITEM, \
	eo.SEAT_COUNT AS EO_SEAT_COUNT, \
    eo.ID AS EO_ID, \
    eo.CHANNEL_PARTNER_SET AS CHANNEL_PARTNER_SET, \
    eo.TENANT_ID AS EO_TENANT_ID, \
    eo.ENTITLEMENT_ID AS ENTITLEMENT_ID, \
    eo.COMMENTS AS COMMENTS, \
    eo.SHIP_TO_EMAIL AS SHIP_TO_EMAIL, \
    eo.SHIP_TO_ADDRESS AS SHIP_TO_ADDRESS, \
    eo.ALLOW_PORTAL_LOGIN AS ALLOW_PORTAL_LOGIN, \
    eo.[STATUS] AS EO_STATUS \
    </#if> \
    FROM \
    OPS_ACTIVATABLE_ITEM ai WITH (NOLOCK) \
    INNER JOIN OPS_ENTITLEMENT_PRODUCT e WITH (NOLOCK) ON ai.ENTITLEMENT_PRODUCT_ID=e.ID AND (ai.TENANT_ID=e.TENANT_ID) \
	INNER JOIN OPS_ENTITLEMENT_ORDER eo WITH (NOLOCK) ON ai.PARENT_ENTITLEMENT_ID = eo.ID AND (ai.TENANT_ID = eo.TENANT_ID) \
    <#if config.showSoldTo()> \
    LEFT OUTER JOIN OPS_ACTIVATABLE_ITEM pai WITH (NOLOCK) ON pai.PARENT_LINE_ITEM=ai.ID and ai.TENANT_ID=pai.TENANT_ID \
    </#if> \
    WHERE ai.ACTIVATABLE_ITEM_TYPE in \
        ('com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO',  \
         'bo.constants.activatableitem.type.webregkey',\
         'bo.constants.activatableitem.type.entitlement_line_item') \
    AND ai.TENANT_ID=:tenantId \
    AND (ai.[STATUS]=:activatableItemTestStatus OR ai.[STATUS]=:activatableItemDeployedStatus) \
    <#if config.showItemWithZeroCopies()> \
    AND e.REMAINING_COPIES > 0 \
    </#if> \
    AND (eo.[STATUS]=:entitlementOrderTestStatus OR eo.[STATUS]=:entitlementOrderDeployedStatus) \
    AND ai.IS_BULK_LINE_ITEM <> :bulkLineItem \
    <#if config.showSoldTo()> \
    AND pai.ID IS NULL \
    </#if> \
    <#if !config.countOnly()> \
    ORDER BY ai.LAST_MODIFIED DESC \
    OFFSET :offsetRow ROWS \
    FETCH NEXT :fetchRows ROWS ONLY \
    </#if> \
  ) \
  <#if config.countOnly()> \
  , ENTITLEMENT_ORDERABLE_SET_CTE \
    (ID) AS ( \
    SELECT eor.ENTITLED_ORDERABLE_SET_ID AS ID \
    FROM OPS_ENTITLED_ORDERABLE eor WITH (NOLOCK) \
    INNER JOIN PROD_ORDERABLE po WITH (NOLOCK) ON eor.ORDERABLE_ID=po.ID AND po.TENANT_ID = eor.TENANT_ID \
    WHERE eor.TENANT_ID=:tenantId AND po.PRODUCT_CATEGORY_ID IN (:productCategoryIds) \
  ) \
  </#if> \
  SELECT \
  <#if config.countOnly()> \
  COUNT(ai.ID) \
  <#else> \
  ai.ID AS col_0_0_, \
  ai.ENTITLED_ORDERABLES AS col_1_0_, \
  ai.ACTIVATABLE_ITEM_TYPE AS col_2_0_, \
  ai.SUPPORT_ACTION AS col_3_0_, \
  ai.ACTIVATION_ID AS col_4_0_, \
  ai.CREATED_ON AS col_5_0_, \
  ai.LAST_MODIFIED AS col_6_0_, \
  ai.AUDIT_CREATEDBY AS col_7_0_, \
  ai.AUDIT_UPDATEDBY AS col_8_0_, \
  ai.[STATUS] AS col_9_0_, \
  ai.SEAT_COUNT AS col_10_0_, \
  ai.EO_SEAT_COUNT AS col_11_0_, \
  ai.FULFILLED_AMOUNT AS col_12_0_, \
  ai.AVAILABLE_REALLOCATION_COUNT AS col_13_0_, \
  ai.REMAINING_COPIES AS col_14_0_, \
  ai.IS_PERMANENT AS col_15_0_, ai.VALID_UNTIL AS col_16_0_, \
  ai.DURATION AS col_17_0_, \
  ai.DURATION_UNITS AS col_18_0_, \
  ai.ORDER_ID AS col_19_0_, \
  ai.ORDER_LINE_NUMBER AS col_20_0_, \
  ai.MAINTENANCE_EXPIRATION_DATE AS col_21_0_, \
  ai.START_DATE_OPTIONS AS col_22_0_, \
  ai.VALID_AFTER AS col_23_0_, \
  ai.VERSION_DATE AS col_24_0_, \
  ai.VERSION_DATE_OPTIONS AS col_25_0_, \
  ai.VERSION_DATE_DURATION AS col_26_0_, \
  ai.VERSION_DATE_DUR_UNITS AS col_27_0_, \
  ai.[DESCRIPTION] AS col_28_0_, \
  ai.EO_ID AS col_29_0_, \
  ai.ENTITLEMENT_ID AS col_30_0_, \
  ai.COMMENTS AS col_31_0_, \
  ai.SHIP_TO_EMAIL AS col_32_0_, \
  ai.SHIP_TO_ADDRESS AS col_33_0_, \
  ai.ALLOW_PORTAL_LOGIN AS col_34_0_, \
  ai.EO_STATUS AS col_35_0_, \
  ai.CHANNEL_PARTNER_SET AS col_36_0_, \
  <#if config.showSoldTo()> \
  ou.ID AS col_37_0_, \
  ou.[NAME] AS col_38_0_, \
  ou.DISPLAYNAME AS col_39_0_, \
  </#if> \
  <#if config.showLicenseModel()> \
  lm.ID AS col_40_0_, \
  lm.[NAME] AS col_41_0_,  \
  lm.MODEL_TYPE As col_42_0_, \
  alm1.ID AS col_43_0_, \
  alm1.[NAME] AS col_44_0_, \
  alm1.MODEL_TYPE AS col_45_0_, \
  alm2.ID AS col_46_0_, \
  alm2.[NAME] AS col_47_0_, \
  alm2.MODEL_TYPE AS col_48_0_, \
  </#if> \
  1 AS col_end \
  </#if> \
  FROM \
  ACTIVATABLE_ITEM_CTE ai \
  <#if config.countOnly()> \
  INNER JOIN ENTITLEMENT_ORDERABLE_SET_CTE os ON os.ID = ai.ENTITLED_ORDERABLES \
  </#if> \
  <#if config.showLicenseModel()> \
  LEFT OUTER JOIN PROD_LICENSE_MODEL lm WITH (NOLOCK) ON ai.LICENSEMODEL_ID=lm.ID \
  LEFT OUTER JOIN PROD_LICENSE_MODEL alm1 WITH (NOLOCK) ON ai.ALT_LICENSEMODEL1_ID=alm1.ID \
  LEFT OUTER JOIN PROD_LICENSE_MODEL alm2 WITH (NOLOCK) ON ai.ALT_LICENSEMODEL2_ID=alm2.ID \
  </#if> \
  <#if config.showSoldTo()> \
  INNER JOIN OPS_CHANNEL_PARTNER_SET cp WITH (NOLOCK) ON CHANNEL_PARTNER_SET=cp.ID AND cp.TENANT_ID=EO_TENANT_ID \
  INNER JOIN OPS_ENT_PARTNER_TIER pt WITH (NOLOCK) ON cp.ID=pt.CHANNEL_PARTNER_SET_ID AND cp.TENANT_ID=ai.TENANT_ID \
  INNER JOIN OPS_PARTNER_TIER_NAME ptn WITH (NOLOCK) ON pt.PARTNER_TIER_ID=ptn.ID AND ptn.TENANT_ID=ai.TENANT_ID \
  INNER JOIN PLT_ORGUNIT ou WITH (NOLOCK) ON pt.ORG_UNIT_ID=ou.ID AND pt.TENANT_ID=ou.TENANT_ID \
  WHERE ptn.[NAME]='bo.constants.partnertiernames.endcustomer' \
  </#if>

EntitlementLineItemBO.getHostsForUpgradeUpsell = \
select distinct host \
from com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as ent \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.relatedOrderables as item \
	inner join ent.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and item.relatedOrderable = ? \
	and soldTo.id = ? \
	and item.relationType IN (?,?) AND instance.tenantId_=:tenantId
	
EntitlementLineItemBO.getLineItemByHostForUpgradeUpsell = \
select distinct lineitem \
from com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.relatedOrderables as item \
	where item.relatedOrderable = ? \
	and host.id = ? \
	and item.relationType IN (?,?) AND instance.tenantId_=:tenantId
	  
EntitlementLineItemBO.getLineItemByHost = \
select distinct lineitem \
from com.flexnet.operations.bizobjects.ActivationInstance as instance \
	and host.id = ? AND instance.tenantId_=:tenantId
	
EntitlementLineItemBO.getLineItemByHostForRenew = \
select distinct lineitem \
from com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.hostEntity as host \
    inner join instance.entitlementLineItem as lineitem \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	where entOrderableSet.productIds = ? \
	and host.id = ? \
	and lineitem.id != ? AND instance.tenantId_=:tenantId
	
ActivatableItemBO.getChildItemsFromBulkSpec = \
select  parentLi.id, childLi.id, childLi.activationID_ \
	from com.flexnet.operations.services.bulkOperations.WorkItemDO as workitem, \
	com.flexnet.operations.services.bulkOperations.BulkOperationSpecDO spec \
	inner join workitem.entitlementLineItemFrom_ as parentLi \
	left outer join workitem.entitlementLineItemTo_ as childLi \
	inner join workitem.workBatch_ workBatch \
	where spec.workBatch_.id = workBatch.id \
	and spec.id = ? \
	and parentLi.id IN (:idList) AND spec.tenantId_=:tenantId
	   
ActivatableItemBO.getAllPossibleChildLineItemsForUpgradeUpsell = \
select distinct lineItem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.relatedOrderables as item \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and lineItem.status_ = ? \
	and item.relatedOrderable = ? \
	and lineItem.supportAction_ = ? \
	and item.relationType IN (?,?) \
	and lineItem.isBulkLineItem_ != 1 \
	and (licModel.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel1.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel2.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL')) AND entitlement.tenantId_=:tenantId
	
ActivatableItemBO.getAllPossibleChildLineItemsForUpgradeUpsellWithActId = \
select distinct lineItem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	inner join orderable.relatedOrderables as item \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and lineItem.status_ = ? \
	and item.relatedOrderable = ? \
	and lineItem.supportAction_ = ? \
	and item.relationType IN (?,?) \
	and lineItem.isBulkLineItem_ != 1 \
	and (licModel.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel1.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel2.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL')) AND entitlement.tenantId_=:tenantId \
	and lineItem.activationID_ = :actId

#native query is used for performance improvement SWM-2266
ActivatableItemBO.getOrderablesByOrderableSet = \
SELECT  entitledor1_.ENTITLED_ORDERABLE_SET_ID, orderable2_.ID, orderable2_.NAME , orderable2_.VERSION, \
		orderable2_.DESCRIPTION , entitledor1_.ORDERABLE_QUANTITY, orderable2_.CREATED_ON \
  FROM  OPS_ENTITLED_ORDERABLE entitledor1_ \
       INNER JOIN PROD_ORDERABLE orderable2_ ON entitledor1_.ORDERABLE_ID = orderable2_.ID \
 WHERE ( entitledor1_.ENTITLED_ORDERABLE_SET_ID IN (:idList)) \
   AND orderable2_.TENANT_ID = entitledor1_.TENANT_ID \
   AND entitledor1_.TENANT_ID =CONVERT(nvarchar(255), :tenantId) 

ActivatableItemBO.getAllParentLineItems = \
select DISTINCT lineItem.parentLineItem_.id \
from com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as lineItem \
where lineItem.parentLineItem_.status_ in ('bo.constants.states.deployed') AND lineItem.tenantId_=:tenantId

ActivatableItemBO.getMaintenancesByLineItem = \
select activatableitem.id, maint.id, product.id, product.name_, product.version_, maint.validUntil_, maint.permanent_, maint.validAfter_, maint.activationID_, maint.orderID_, maint.orderLineNumber_, maint.status_ ,maint \
	from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as activatableitem \
	inner join activatableitem.maintenanceItems_ as activatableMaintenance \
	inner join activatableMaintenance.maintenanceItem as maint \
  	inner join maint.orderable_ as product \
	where activatableitem.id IN (:idList)  AND activatableitem.tenantId_= convert(nvarchar(255),:tenantId)  order by maint.validUntil_ desc

ActivatableItemBO.getMaintenancesWithSkuByLineItem = \
select activatableitem.id, maint.id, product.id, product.name_, product.version_, maint.validUntil_, maint.permanent_, maint.validAfter_, maint.activationID_, maint.orderID_, maint.orderLineNumber_, maint.status_, sku.id, sku.sku \
	from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as activatableitem \
	inner join activatableitem.maintenanceItems_ as activatableMaintenance \
	inner join activatableMaintenance.maintenanceItem as maint \
	inner join maint.orderable_ as product \
	left outer join maint.sku_ as sku \
	where activatableitem.id IN (:idList)  AND activatableitem.tenantId_=:tenantId order by maint.validUntil_ desc	

ActivatableItemBO.getPartnersByChannelPartnerSet = \
	select channelPartnerSet.id, channel \
	from com.flexnet.operations.bizobjects.entitlements.ChannelPartnerSetDO as channelPartnerSet \
	inner join channelPartnerSet.channelPartners_ as channel \
	where channelPartnerSet.id IN (:idList) and channel.tenantId_ = :tenantId AND channelPartnerSet.tenantId_=:tenantId


ActivatableItemBO.getPartnersByChannelPartnerSetForOrder = \
	select channelPartnerSet.id, partnerTier.id, orgUnit.id, orgUnit.name_, orgUnit.displayName_, partnerTier.name, channel.currentOwner, channel.contact_.id \
	from com.flexnet.operations.bizobjects.entitlements.ChannelPartnerSetDO as channelPartnerSet \
	inner join channelPartnerSet.channelPartners_ as channel \
	inner join channel.orgUnit_ as orgUnit \
	inner join channel.partnerTier_ as partnerTier \
	where channelPartnerSet.id IN (:idList) and channel.tenantId_ = :tenantId AND \
	channelPartnerSet.tenantId_=:tenantId AND orgUnit.tenantId_ = :tenantId  AND partnerTier.tenantId_ = :tenantId
	
ActivatableItemBO.getTotalWebRegKeysForBulkEnt = \
	select entitlement.id, count(webregkey.id) from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as webregkey \
	inner join webregkey.parentEntitlement_ as entitlement \
	where webregkey.isBulkLineItem_ = false and \
	entitlement.id IN (:idList) \
	 AND webregkey.tenantId_=:tenantId group by entitlement.id 
			
EntitlementLineItemBO.getAllPossibleChildLineItemsForRenew = \
select distinct lineItem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and lineItem.status_ = ? \
	and entOrderableSet.productIds = ? \
	and lineItem.supportAction_ = ? \
	and lineItem.isBulkLineItem_ != 1 \
	and lineItem.id != ? \
	and (licModel.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel1.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel2.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL')) AND entitlement.tenantId_=:tenantId
		
EntitlementLineItemBO.getChildLineItemsForRenewByActivationId = \
select lineItem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.entitlementLineItems_ as lineItem \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and soldTo.id = ? \
	and lineItem.status_ = ? \
	and entOrderableSet.productIds = ? \
	and lineItem.supportAction_ = ? \
	and lineItem.isBulkLineItem_ != 1 \
	and lineItem.activationID_ = ? \
	and (licModel.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel1.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL') \
	or altModel2.modelType_ IN ('FLOATING_CERTIFICATE', 'NODE_LOCKED', 'CUSTOM_LICENSE_MODEL')) AND entitlement.tenantId_=:tenantId 
	
	
LicenseHost.getHostsForLineItem = \
		select host \
		from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as act \
		inner join act.hostIds_ as ehost \
		inner join ehost.host as host \
		where act.id=? \
		 AND act.tenantId_=:tenantId order by host.hostId_

LicenseHost.getHostsForLineItemCount = \
select count(host) \
		from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as act \
		inner join act.hostIds_ as ehost \
		inner join ehost.host as host \
		where act.id=? AND act.tenantId_=:tenantId

EntitlementBO.referencedInOtherEntDueToTransfer = \
	select count(entitlement) from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.transferredFromEntitlement_ as product \
	where product.id = ? AND entitlement.tenantId_=:tenantId

EntitlementBO.referencedInOtherSimpleEnts = \
	select entitlement from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.parentBulkEntitlement_ as ent \
	where ent.id = ? AND entitlement.tenantId_=:tenantId
	
ActivatableItemBO.referencedInOtherLineItemsDueToTransfer = \
	select lineitem from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as lineitem \
	inner join lineitem.transferredFromLineItem_ as transferredLineItem \
	where transferredLineItem.id = ? AND lineitem.tenantId_=:tenantId  and transferredLineItem.tenantId_=:tenantId

ActivatableItemBO.referencedInOtherLineItemsDueToSplit = \
	select lineitem from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as lineitem \
	inner join lineitem.splitFromLineItem_ as splitLineItem \
	where splitLineItem.id = ? AND lineitem.tenantId_=:tenantId  and splitLineItem.tenantId_=:tenantId

ActivatableItemBO.referencedInFulfillmentHistory = \
	select lineitem from \
 	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as fulfillHistory \
	inner join fulfillHistory.lineItemID_ as lineitem \
	where lineitem.id = ? AND fulfillHistory.tenantId_=:tenantId and  lineitem.tenantId_=:tenantId
		
LicenseTechnology.getLicTechForAllAttributes = \
select distinct tech \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as attrib \
	inner join attrib.licenseTechnology_ as tech  WHERE attrib.tenantId_=:tenantId order by tech.id

LicenseTechnology.getCountOfLicTechForAllAttributes = \
select count(distinct tech) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as attrib \
	inner join attrib.licenseTechnology_ as tech WHERE attrib.tenantId_=:tenantId

#Changed the query below to fix export of all custom host attributes
#LicenseTechnology.getLicTechForAllHostAttributes = \
#select distinct tech \
#from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as attrib \
#inner join attrib.licenseTechnology_ as tech order by tech.id
	
LicenseTechnology.getLicTechForAllHostAttributes = \
select distinct tech from com.flexnet.products.bizobjects.LicenseTechnologyBO as tech \
	where id IN (select hostTypes.licenseTechnology_.id from com.flexnet.products.bizobjects.HostTypeDO as hostTypes \
		where id IN (select obj.hostType_.id from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj )) AND obj.tenantId_=:tenantId

LicenseTechnology.getCountOfLicTechForAllHostAttributes = \
select count(distinct tech) \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as attrib \
	inner join attrib.licenseTechnology_ as tech WHERE attrib.tenantId_=:tenantId

LicenseTechnology.getLicTechForAllGenerators = \
select distinct tech \
	from com.flexnet.products.bizobjects.LicenseGeneratorConfigBO as gen \
	inner join gen.licenseTechnology_ as tech  WHERE gen.tenantId_=:tenantId order by tech.id

LicenseTechnology.getCountOfLicTechForAllGenerators = \
select count(distinct tech) \
	from com.flexnet.products.bizobjects.LicenseGeneratorConfigBO as gen \
	inner join gen.licenseTechnology_ as tech WHERE gen.tenantId_=:tenantId

LicenseTechnology.getLicTechForAllModels = \
select distinct tech \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	inner join model.licenseTechnology_ as tech  WHERE model.tenantId_=:tenantId order by tech.id

LicenseTechnology.getCountOfLicTechForAllModels = \
select count(distinct tech) \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	inner join model.licenseTechnology_ as tech	 WHERE model.tenantId_=:tenantId
	
LicenseModelAttribute.getAttributesForAllGenerators = \
select distinct attr \
	from com.flexnet.products.bizobjects.LicenseGeneratorConfigBO as gen \
	inner join gen.licenseTechnology_ as tech \
	inner join tech.attributes as attr \
	where attr.licenseAttribute = false  AND gen.tenantId_=:tenantId order by attr.id

LicenseModelAttribute.getCountOfAttributesForAllGenerators= \
select count(distinct attr) \
	from com.flexnet.products.bizobjects.LicenseGeneratorConfigBO as gen \
	inner join gen.licenseTechnology_ as tech \
	inner join tech.attributes as attr \
	where attr.licenseAttribute = false	 AND gen.tenantId_=:tenantId

LicenseModelAttribute.getAttributesForAllModels = \
select distinct attr \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	inner join model.licenseTechnology_ as tech \
	inner join tech.attributes as attr \
	where attr.licenseAttribute = true  AND model.tenantId_=:tenantId order by attr.id

LicenseModelAttribute.getCountOfAttributesForAllModels= \
select count(distinct attr) \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	inner join model.licenseTechnology_ as tech \
	inner join tech.attributes as attr \
	where attr.licenseAttribute = true		 AND model.tenantId_=:tenantId

EntitlementLineItemBO.getAllRootEntLineItems = \
	select childItem from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as childItem \
	where childItem.isBulkLineItem_ = false  AND childItem.tenantId_=:tenantId order by childItem.id

EntitlementLineItemBO.getCountOfAllRootEntLineItems= \
	select count(childItem) from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as childItem \
	where childItem.parentLineItem_.id is null \
	and childItem.isBulkLineItem_ = false	 AND childItem.tenantId_=:tenantId

EntitlementLineItemBO.getAllLineItemsOrderedById= \
	select distinct lineItem from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as lineItem \
	where lineItem.isBulkLineItem_ = false \
	and lineItem.fulfilledAmount_ > 0 \
	 AND lineItem.tenantId_=:tenantId order by lineItem.id

EntitlementLineItemBO.getCountOfAllLineItemsOrderedById= \
	select count(distinct lineItem) from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as lineItem \
	where lineItem.isBulkLineItem_ = false \
	and lineItem.fulfilledAmount_ > 0 AND lineItem.tenantId_=:tenantId

SimpleEntitlementBO.getEntitlementsForAllFulfillments= \
	select distinct ent from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent  WHERE fulfillment.tenantId_=:tenantId order by ent.id

SimpleEntitlementBO.getCountOfEntitlementsForAllFulfillments= \
	select count(distinct ent) from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent  WHERE fulfillment.tenantId_=:tenantId

BulkEntitlementBO.getParentBulkForAllFulfillments= \
	select distinct parentBulk from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent \
	inner join ent.parentBulkEntitlement_ as parentBulk  WHERE fulfillment.tenantId_=:tenantId order by parentBulk.id

BulkEntitlementBO.getCountOfParentBulkForAllFulfillments= \
	select count(distinct parentBulk) from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent \
	inner join ent.parentBulkEntitlement_ as parentBulk WHERE fulfillment.tenantId_=:tenantId

SimpleEntitlementBO.getEntitlementsForAllLineItems= \
	select distinct ent from \
	com.flexnet.operations.bizobjects.entitlements.SimpleEntitlementBO as ent \
	inner join ent.entitlementLineItems_ as lineItem  WHERE ent.tenantId_=:tenantId order by ent.id	

SimpleEntitlementBO.getCountOfEntitlementsForAllLineItems= \
	select count(distinct ent) from \
	com.flexnet.operations.bizobjects.entitlements.SimpleEntitlementBO as ent \
	inner join ent.entitlementLineItems_ as lineItem WHERE ent.tenantId_=:tenantId

BulkEntitlementBO.getParentBulkForAllSimpleEnts= \
	select distinct parentBulk from \
	com.flexnet.operations.bizobjects.entitlements.SimpleEntitlementBO as ent \
	inner join ent.parentBulkEntitlement_ as parentBulk	 WHERE ent.tenantId_=:tenantId order by parentBulk.id

BulkEntitlementBO.getCountOfParentBulkForAllSimpleEnts = \
	select count(distinct parentBulk) from \
	com.flexnet.operations.bizobjects.entitlements.SimpleEntitlementBO as ent \
	inner join ent.parentBulkEntitlement_ as parentBulk	 WHERE ent.tenantId_=:tenantId

BulkEntitlementBO.getBulkForAllWebRegKeys = \
	select distinct bulkEnt from \
	com.flexnet.operations.bizobjects.entitlements.BulkEntitlementBO as bulkEnt \
	inner join bulkEnt.webRegKeys_	 WHERE bulkEnt.tenantId_=:tenantId order by bulkEnt.id

BulkEntitlementBO.getCountOfBulkForAllWebRegKeys = \
	select count(distinct bulkEnt) from \
	com.flexnet.operations.bizobjects.entitlements.BulkEntitlementBO as bulkEnt \
	inner join bulkEnt.webRegKeys_	 WHERE bulkEnt.tenantId_=:tenantId

Orderable.getOrderablesForAllFulfillments= \
	select distinct orderable from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as lineitem \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable  WHERE fulfillment.tenantId_=:tenantId order by orderable.id

Orderable.getCountOfOrderablesForAllFulfillments= \
	select count (distinct orderable) from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as lineitem \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable WHERE fulfillment.tenantId_=:tenantId

BulkEntitlementBO.getParentBulkForAllConsolidatedLicenses= \
	select distinct parentBulk from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent \
	inner join ent.parentBulkEntitlement_ as parentBulk  WHERE conLic.tenantId_=:tenantId order by parentBulk.id

BulkEntitlementBO.getCountOfParentBulkForAllConsolidatedLicenses= \
	select count (distinct parentBulk) from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent \
	inner join ent.parentBulkEntitlement_ as parentBulk WHERE conLic.tenantId_=:tenantId

SimpleEntitlementBO.getSimpleEntsForAllConsolidatedLicenses= \
	select distinct ent from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent  WHERE conLic.tenantId_=:tenantId order by ent.id

SimpleEntitlementBO.getCountOfSimpleEntsForAllConsolidatedLicenses= \
	select count(distinct ent) from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent WHERE conLic.tenantId_=:tenantId

Fulfillment.getFulfillmentsForAllConsolidatedLicenses= \
	select distinct fulfillment from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment  WHERE conLic.tenantId_=:tenantId order by fulfillment.id
	
	
Orderable.getOrderablesForAllConsolidatedLicenses = \
	select distinct orderable from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as lineitem \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable  WHERE conLic.tenantId_=:tenantId order by orderable.id
	
Orderable.getCountOfOrderablesForAllConsolidatedLicenses = \
	select count(distinct orderable) from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as lineitem \
	inner join lineitem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable WHERE conLic.tenantId_=:tenantId
	
EntitlementLineItemBO.getAllRootEntLineItemsWithConsolidatedLicenses = \
	select distinct childItem from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	where childItem.parentLineItem_ is null \
	and childItem.isBulkLineItem_ = false  AND conLic.tenantId_=:tenantId order by childItem.id
	
EntitlementLineItemBO.getCountOfAllRootEntLineItemsWithConsolidatedLicenses = \
	select count(distinct childItem) from \
	com.flexnet.operations.bizobjects.ConsolidatedLicenseBO as conLic \
	inner join conLic.consolidatedFulFillments as consolidatedFulfillments \
	inner join consolidatedFulfillments.fulfillment as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	where childItem.parentLineItem_ is null \
	and childItem.isBulkLineItem_ = false AND conLic.tenantId_=:tenantId
	
Org.getOrgsForAllFulfillments = \
	select distinct soldTo from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as childItem \
	inner join childItem.parentEntitlement_ as ent \
	inner join ent.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.orgUnit_ as soldTo  WHERE fulfillment.tenantId_=:tenantId order by soldTo.id 
	
Org.getLatestOrgsIds=\
    select org.id from com.flexnet.platform.bizobjects.OrgUnit AS org \
    where ((org.auditInfo.updatedOn >=  :after and org.auditInfo.updatedOn < :before) \
    or (org.auditInfo.createdOn >= :after  and org.auditInfo.createdOn < :before)) \
      AND org.tenantId_=:tenantId order by org.id
      
Org.getAllOrgsIds=\
    select org.id from com.flexnet.platform.bizobjects.OrgUnit AS org \
    where org.tenantId_=:tenantId order by org.id
     
Org.getLatestOrgs=\
    select org from com.flexnet.platform.bizobjects.OrgUnit AS org \
    where org.id IN (:idList) \
      AND org.tenantId_=:tenantId order by org.id  

Org.getOrgById=\
    select org.name_ from com.flexnet.platform.bizobjects.OrgUnit AS org \
    where org.id = :id AND org.tenantId_= :tenantId     
     
Org.getAllOrgs = \
	select org from \
	com.flexnet.platform.bizobjects.OrgUnit AS org  WHERE org.tenantId_=:tenantId order by org.id

Org.getCountOfAllOrgs = \
	select count(org) from \
	com.flexnet.platform.bizobjects.OrgUnit AS org 	 WHERE org.tenantId_=:tenantId
	
CustomAttribute.getSearchableLicenseModelAttributes=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableLicenseModelAttributes=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'LONGTEXT' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.attributeName != 'DUP_GROUP' AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableLicenseModelAttributesForDeployedTech=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and tech.status_ = 'bo.constants.states.deployed' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableLicenseModelAttributesForDeployedTech=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and tech.status_ = 'bo.constants.states.deployed' AND obj.tenantId_=:tenantId
		
HostEntityBO.getHostWhenNoOwner = \
	select host from \
	com.flexnet.operations.bizobjects.HostEntityBO as host \
	inner join host.soldTo as soldTo \
	where soldTo.id = ? \
	and host.hostId_ = ? \
	and host.hostEntityType = ? \
	and host.licenseTechnology_ = ? \
	and owner is null AND host.tenantId_=:tenantId
	
HostEntityBO.getHostWithHostTypeWhenNoOwner = \
	select host from \
	com.flexnet.operations.bizobjects.HostEntityBO as host \
	inner join host.soldTo as soldTo \
	where soldTo.id = ? \
	and host.hostId_ = ? \
	and host.hostEntityType = ? \
	and host.licenseTechnology_ = ? \
	and host.hostType_ = ? \
	and owner is null AND host.tenantId_=:tenantId
	
HostEntityBO.getServerHostWhenNoOwner = \
	select host from \
	com.flexnet.operations.bizobjects.HostEntityBO as host \
	inner join host.soldTo as soldTo \
	where soldTo.id = ? \
	and host.hostId_ = ? \
	and host.hostEntityType = ? \
	and owner is null AND host.tenantId_=:tenantId

CustomAttribute.getSearchableCustomLicModelAttrsAtFulfillTime=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedFulfillmentTime = 1 \
	 AND obj.tenantId_=:tenantId order by obj.attributeName
	
CustomAttribute.getCountOfSearchableCustomLicModelAttrsAtFulfillTime=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'LONGTEXT' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.allowedFulfillmentTime = 1	\
	and obj.attributeName != 'DUP_GROUP' AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomLicModelAttrsAtFulfillTimeForDeployedTech=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedFulfillmentTime = 1	\
	and tech.status_ = 'bo.constants.states.deployed' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableCustomLicModelAttrsAtFulfillTimeForDeployedTech=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedFulfillmentTime = 1	\
	and tech.status_ = 'bo.constants.states.deployed' AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomLicModelAttrsAtEntTime=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedEntitlementTime = 1 \
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableCustomLicModelAttrsAtEntTime=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'LONGTEXT' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.allowedEntitlementTime = 1	\
	and obj.attributeName != 'DUP_GROUP' AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomLicModelAttrsAtEntTimeForDeployedTech=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedEntitlementTime = 1	\
	and tech.status_ = 'bo.constants.states.deployed' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableCustomLicModelAttrsAtEntTimeForDeployedTech=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedEntitlementTime = 1	\
	and tech.status_ = 'bo.constants.states.deployed' AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableLicModelAttrsAtLicModelTime=\
	select distinct obj.attributeName, obj.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.type != 'LONGTEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedModelTime = 1	\
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableLicModelAttrsAtLicModelTime=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as obj \
	where obj.licenseAttribute = '1' \
	and obj.type != 'LONGTEXT' \
	and obj.type != 'MULTI_VALUED_TEXT' \
	and obj.attributeName != 'DUP_GROUP' \
	and obj.allowedModelTime = 1			 AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomHostAttributes=\
	select distinct obj.attributeName, metadata.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.extPropMetaData as metadata \
	where obj.licenseTechnology_.id is null \
	and metadata.type != 'MULTI_VALUED_TEXT' \
	and metadata.type != 'LONGTEXT' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName
	
CustomAttribute.getCountOfSearchableCustomHostAttributes=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.extPropMetaData as metadata \
	where obj.licenseTechnology_.id is null \
	and metadata.type != 'MULTI_VALUED_TEXT' \
	and metadata.type != 'LONGTEXT'  AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomHostAttributesForDeployedTech=\
	select distinct obj.attributeName, plt.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.hostType_ as hostTypes \
	inner join hostTypes.licenseTechnology_ as tech \
	inner join obj.extPropMetaData as plt \
	where obj.hostType_.id = hostTypes.hostTypeId \
	and hostTypes.licenseTechnology_.id != 100 \
	and hostTypes.licenseTechnology_.id = tech.id \
	and tech.status_ = 'bo.constants.states.deployed' \
	and obj.extPropMetaData = plt.id \
	and plt.type != 'MULTI_VALUED_TEXT' \
	and plt.type != 'LONGTEXT' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName 

CustomAttribute.getCountOfSearchableCustomHostAttributesForDeployedTech=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.hostType_ as hostTypes \
	inner join hostTypes.licenseTechnology_ as tech \
	inner join obj.extPropMetaData as plt \
	where obj.hostType_.id = hostTypes.hostTypeId \
	and hostTypes.licenseTechnology_.id != 100 \
	and hostTypes.licenseTechnology_.id = tech.id \
	and tech.status_ = 'bo.constants.states.deployed' \
	and obj.extPropMetaData = plt.id \
	and plt.type != 'MULTI_VALUED_TEXT' \
	and plt.type != 'LONGTEXT' AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomDeviceAttributes=\
	select distinct obj.attributeName, metadata.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.extPropMetaData as metadata \
	where obj.licenseTechnology_.id = 100 \
	and metadata.type != 'MULTI_VALUED_TEXT' \
	and metadata.type != 'LONGTEXT' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName
	
CustomAttribute.getCountOfSearchableCustomDeviceAttributes=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.extPropMetaData as metadata \
	where obj.licenseTechnology_.id = 100 \
	and metadata.type != 'MULTI_VALUED_TEXT' \
	and metadata.type != 'LONGTEXT'  AND obj.tenantId_=:tenantId

CustomAttribute.getSearchableCustomDeviceAttributesForDeployedTech=\
	select distinct obj.attributeName, metadata.type \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.extPropMetaData as metadata \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseTechnology_.id = 100 \
	and metadata.type != 'MULTI_VALUED_TEXT' \
	and metadata.type != 'LONGTEXT' \
	and tech.status_ = 'bo.constants.states.deployed' \
	 AND obj.tenantId_=:tenantId order by obj.attributeName

CustomAttribute.getCountOfSearchableCustomDeviceAttributesForDeployedTech=\
	select count(distinct obj.attributeName) \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as obj \
	inner join obj.extPropMetaData as metadata \
	inner join obj.licenseTechnology_ as tech \
	where obj.licenseTechnology_.id = 100 \
	and metadata.type != 'MULTI_VALUED_TEXT' \
	and metadata.type != 'LONGTEXT' \
	and tech.status_ = 'bo.constants.states.deployed'  AND obj.tenantId_=:tenantId
	
TrustedActivation.getFulfillmentsRecordsForUmn1=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType1 as umn1 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn1.hostId = ?	 AND instance.tenantId_=:tenantId AND lineItem.tenantId_=:tenantId AND hostEntity.tenantId_=:tenantId AND umn1.tenantId_ = :tenantId
	
TrustedActivation.getFulfillmentsRecordsForUmn2=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType2 as umn2 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn2.hostId = ?	 AND instance.tenantId_=:tenantId AND lineItem.tenantId_=:tenantId AND hostEntity.tenantId_=:tenantId AND umn2.tenantId_ = :tenantId
	
TrustedActivation.getFulfillmentsRecordsForUmn3=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType3 as umn3 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn3.hostId = ?	 AND instance.tenantId_=:tenantId AND lineItem.tenantId_=:tenantId AND hostEntity.tenantId_=:tenantId AND umn3.tenantId_ = :tenantId

TrustedActivation.getFulfillmentsRecordsForUmn3and5=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType3 as umn3 \
	left outer join hostEntity.umnType5 as umn5 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn3.hostId = ?	\
	and (umn5.hostId IS NULL or umn5.hostId = ?)  AND instance.tenantId_=:tenantId AND lineItem.tenantId_=:tenantId AND hostEntity.tenantId_=:tenantId AND umn3.tenantId_ = :tenantId

TrustedActivation.getFulfillmentsRecordsForUmn5=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType5 as umn5 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn5.hostId = ?	 AND instance.tenantId_=:tenantId AND lineItem.tenantId_=:tenantId AND hostEntity.tenantId_=:tenantId AND umn1.tenantId_ = :tenantId AND umn5.tenantId_ = :tenantId
	
		
TrustedActivation.getFulfillmentsRecordsForMid=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.machineIdentifier as mid \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and mid.hostId = ?	 AND instance.tenantId_=:tenantId

TrustedActivation.getFulfillmentsRecordsForUmn1ForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType1 as umn1 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn1.hostId like ?	 AND instance.tenantId_=:tenantId

TrustedActivation.getFulfillmentsRecordsForUmn2ForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType2 as umn2 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn2.hostId like ?	 AND instance.tenantId_=:tenantId

TrustedActivation.getFulfillmentsRecordsForUmn3ForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType3 as umn3 \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and umn3.hostId like ?	 AND instance.tenantId_=:tenantId

TrustedActivation.getFulfillmentsRecordsForMidForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.entitlementLineItem as lineItem \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.machineIdentifier as mid \
	where lineItem.activationID_= ? \
	and instance.status_= 'bo.constants.states.active' \
	and mid.hostId like ? AND instance.tenantId_=:tenantId

TrustedActivation.getAllFulfillmentsRecordsForUmn1ForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType1 as umn1 \
	where instance.asrAlias= ? \
	and umn1.hostId like ? AND instance.tenantId_=:tenantId
	
TrustedActivation.getAllFulfillmentsRecordsForUmn2ForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType2 as umn2 \
	where instance.asrAlias= ? \
	and umn2.hostId like ? AND instance.tenantId_=:tenantId

TrustedActivation.getAllFulfillmentsRecordsForUmn3ForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.umnType3 as umn3 \
	where instance.asrAlias= ? \
	and umn3.hostId like ? AND instance.tenantId_=:tenantId

TrustedActivation.getAllFulfillmentsRecordsForMidForShortCode=\
	select instance from \
	com.flexnet.operations.trusted.TrustedActivationInstance as instance \
	inner join instance.hostEntity as hostEntity \
	inner join hostEntity.machineIdentifier as mid \
	where instance.asrAlias= ? \
	and mid.hostId like ? AND instance.tenantId_=:tenantId


LicenseDefinition.containsFulfillments=\
	select fulfillment from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.licenseText_ as licenseFile \
	inner join licenseFile.licenseFileDefinition_ as licFileDef \
	inner join licenseFile.licenseTechnology_ as tech \
	where licFileDef.id = ? \
	and tech.id = ? AND fulfillment.tenantId_=:tenantId
	
HostType.containedInOrderables=\
	select orderable from \
	com.flexnet.products.bizobjects.Orderable as orderable \
	inner join orderable.hostTypes_ as hostType \
    inner join hostType.hostType as ht \
	inner join orderable.licenseTechnology_ as tech \
	where ht.id = :hostTypeId \
	and tech.id = :licTechId AND orderable.tenantId_=:tenantId

HostType.containedInHostEntities=\
	select hostEntity from \
	com.flexnet.operations.bizobjects.HostEntityBO as hostEntity \
	inner join hostEntity.hostType_ as hostType \
	inner join hostEntity.licenseTechnology_ as tech \
	where hostType.id = :hostTypeId \
	and tech.id = :licTechId AND hostEntity.tenantId_=:tenantId
	
HostType.containedInExistingHostEntities=\
	select hostEntity from \
	com.flexnet.operations.bizobjects.HostEntityBO as hostEntity \
	inner join hostEntity.hostType_ as hostType \
	where hostType.id = :hostTypeId  AND hostEntity.tenantId_=:tenantId
	
# added by Shalu	
HostType.getFilteredHostTypes=\
     select hostType from \
	 com.flexnet.products.bizobjects.HostTypeDO as hostType \
	 where hostType.licenseTechnology_ != ? \
	 and hostType.licenseTechnology_ != ? \
	 and hostType.id = hostType.hostTypeId \
	 and hostType.hostTypeId not in \
	 (select hostType.hostTypeId from com.flexnet.products.bizobjects.HostTypeDO as hostType \
	  where hostType.licenseTechnology_ = ?)  AND hostType.tenantId_=:tenantId
	
#HostType.getFilteredHostTypes=\
#	select hostType from com.flexnet.products.bizobjects.HostTypeDO as hostType \
#	where hostType.id in \
#		(select min(hostType.id) from com.flexnet.products.bizobjects.HostTypeDO as hostType \
#		 where hostType.name_ not in \
#				(select hostType.name_ from com.flexnet.products.bizobjects.HostTypeDO as hostType \
# 				 where hostType.licenseTechnology_ = ?) and hostType.licenseTechnology_ != ? \
#		group by hostType.name_)
	 
HostType.getNonFlexnetHostTypes=\
	select hostType from \
	com.flexnet.products.bizobjects.HostTypeDO as hostType \
	where hostType.licenseTechnology_ != ? \
	and hostType.id = hostType.hostTypeId  AND hostType.tenantId_=:tenantId
	
HostType.getHostTypesByHostTypeId=\
	select hostType from \
	com.flexnet.products.bizobjects.HostTypeDO as hostType \
	where hostType.hostTypeId = ?  AND hostType.tenantId_=:tenantId

HostType.getAllDeviceHostTypes=\
	select hostType from \
	com.flexnet.products.bizobjects.HostTypeDO as hostType \
	inner join hostType.licenseTechnology_ as tech \
	where tech.name_ = :flexnetLicenseTechName \
	and hostType.name_ != :flexnetHostTypeName AND hostType.tenantId_=:tenantId

HostType.getVisibleDeviceHostTypes=\
	select hostType from \
	com.flexnet.products.bizobjects.HostTypeDO as hostType \
	inner join hostType.licenseTechnology_ as tech \
	where tech.name_ = :flexnetLicenseTechName \
	and hostType.name_ != :flexnetHostTypeName \
	and hostType.visibleOnPortal = 1 AND hostType.tenantId_=:tenantId

HostType.getDeviceHostTypeById=\
	select hostType from \
	com.flexnet.products.bizobjects.HostTypeDO as hostType \
	inner join hostType.licenseTechnology_ as tech \
	where tech.name_ = :flexnetLicenseTechName \
	and hostType.name_ != :flexnetHostTypeName \
	and hostType.id = :id AND hostType.tenantId_=:tenantId
	
HostType.getDeviceHostTypeByName=\
	select hostType from \
	com.flexnet.products.bizobjects.HostTypeDO as hostType \
	inner join hostType.licenseTechnology_ as tech \
	where tech.name_ = :flexnetLicenseTechName \
	and hostType.name_ = :name AND hostType.tenantId_=:tenantId

ProductCategory.containedInOrderables=\
	select orderable from \
	com.flexnet.products.bizobjects.Orderable as orderable \
	inner join orderable.productCategory_ as productCategory \
	where productCategory.id = ?  AND orderable.tenantId_=:tenantId
	
ProductCategory.containedInDeployedOrderables=\
	select orderable from \
	com.flexnet.products.bizobjects.Orderable as orderable \
	inner join orderable.productCategory_ as productCategory \
	where productCategory.id = ? \
	and orderable.status_ = 'bo.constants.states.deployed' AND orderable.tenantId_=:tenantId


ActivationInstance.getLicenseFiles = \
select fulfillment.id, licFileDef.id, licFileDef.name_, licFileDef.description_, licFileDef.licenseStorageType_, tech.id, licenseFile.licenseText_, licenseFile.binaryLicense_ \
	from com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.licenseText_ as licenseFile \
	inner join licenseFile.licenseFileDefinition_ as licFileDef \
	inner join licFileDef.licenseTechnology_ as tech \
	where fulfillment.id IN (:idList) AND fulfillment.tenantId_=:tenantId

ActivationInstance.getNodeLockedHosts = \
select fulfillment.id, node.hostId \
	from com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.nodelockedHostUnits as nlhost \
	inner join nlhost.nodelockedHostUnit as node \
	where fulfillment.id IN (:idList) AND fulfillment.tenantId_=:tenantId

	
# Org Hierarchy and org units, users queries --Start	

User.getSeedUserRowIdByTenantId = SELECT  user.userId_, user.id \
    FROM com.flexnet.platform.bizobjects.User as user \
	WHERE user.userId_ IN (:seedUsers) AND user.tenantId_=:tenantId
	
	
OrgUnit.getAllOrgsCnt=\
select count(*) from \
com.flexnet.platform.bizobjects.OrgUnit  WHERE TENANT_ID=:tenantId
	
OrgUnit.getAllOrgs=\
    select org from com.flexnet.platform.bizobjects.OrgUnit AS org  WHERE org.tenantId_=:tenantId order by org.id

OrgUnit.getUnknowOrgByTenantId = \
    select org from com.flexnet.platform.bizobjects.OrgUnit as org \
    where org.name_='UNKNOWN_ORG_UNIT' and org.tenantId_ \= ?

OrgUnit.getPortalOrgUnitByTenantId = \
    select org from com.flexnet.platform.bizobjects.OrgUnit as org \
	where org.name_='PORTAL_ORG_UNIT' and org.tenantId_ \= ?
	
OrgUnit.getHomeOrgUnitByTenantId = \
	select org from com.flexnet.platform.bizobjects.OrgUnit as org \
	inner join org.types_ as orgtype \
	where orgtype.orgUnitType.name_='HOME' and org.tenantId_ \= ?

OrgUnit.getAllCustomerOrgs = \
	SELECT orgunit FROM com.flexnet.platform.bizobjects.OrgUnit as orgunit \
	INNER JOIN orgunit.types_ as orgunitorgunittype \
    INNER JOIN orgunitorgunittype.orgUnitType as orgunittypes \
	WHERE  orgunit.tenantId_ =:tenantId and orgunittypes.id =:orgUnitTypeId )

OrgHierarchy.getLineage=\
select oh.lineage from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
inner join oh.orgUnit as org \
where org.id = ? AND oh.tenantId_=:tenantId

OrgHierarchy.getOrgHierarchyListForOrgAndParent=\
select oh from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
inner join oh.orgUnit as org \
where org.id = ? AND oh.parentOrgId = ? AND oh.tenantId_=:tenantId

OrgHierarchy.getAllOrgHierarchies=\
select oh from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh  WHERE oh.tenantId_=:tenantId order by oh.id

OrgHierarchy.getAllNullParentOrgs=\
from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
inner join oh.orgUnit as org \
where org.id IN (:idList) AND oh.parentOrgId is NULL AND oh.tenantId_=:tenantId

OrgHierarchy.getOrgWithNullParent=\
select oh from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
inner join oh.orgUnit as org \
where org.id = ? AND oh.parentOrgId is NULL AND oh.tenantId_=:tenantId

OrgHierarchy.getChildrenEntries=\
from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
where oh.parentOrgId = ? AND oh.tenantId_=:tenantId

OrgHierarchy.getFirstLevelSubOrgs=\
SELECT distinct oh2.orgUnit from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh1, \
com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh2 \
inner join oh1.orgUnit as org \
where oh2.parentOrgId = org.id and org.id = ? AND oh2.tenantId_=:tenantId

OrgHierarchy.getAllSubOrgsCnt=\
select count(distinct oh.orgUnit.id) from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
where lineage LIKE ? AND oh.tenantId_=:tenantId

OrgHierarchy.getAllSubOrgs=\
select distinct oh.orgUnit.id from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
where lineage LIKE ? AND oh.tenantId_=:tenantId

OrgHierarchy.getOrgHierarchyListForOrg=\
select oh2 from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh2 \
inner join oh2.orgUnit as org \
where org.id = ? AND oh2.tenantId_=:tenantId

OrgHierarchy.getOrgHierarchyListForSubTree=\
select oh from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh \
where oh.lineage LIKE ? AND oh.tenantId_=:tenantId

OrgHierarchy.getFirstLevelParentOrgs=\
select distinct oh1.orgUnit from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh1, \
com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh2 \
inner join oh2.orgUnit as org \
where oh2.parentOrgId = oh1.orgUnit.id and org.id = ? AND oh2.tenantId_=:tenantId

OrgHierarchy.getOrgContacts=\
select obj from com.flexnet.platform.bizobjects.Contact as obj join obj.belongsTo_ as orgContact join orgContact.orgUnitId_ as org where org.id = ? AND obj.tenantId_=:tenantId

OrgHierarchy.getOrgContactsCnt=\
select count(*) from com.flexnet.platform.bizobjects.Contact  obj join obj.belongsTo_ as orgContact join orgContact.orgUnitId_ as org where org.id = ? AND obj.tenantId_=:tenantId

OrgHierarchy.findChildrenCnt=\
select count(*) from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy oh where oh.parentOrgId = ? AND oh.tenantId_=:tenantId

OrgHierarchy.getAllFilteredRootOrgs=\
select ou from com.flexnet.platform.bizobjects.OrgUnit AS  ou,  com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy AS oh \
 left outer join ou.members_ as members left outer join members.contactId_ as contact where ou.id  NOT IN(:idList) and ou.id= oh.orgUnit.id and oh.parentOrgId is null AND oh.tenantId_=:tenantId

OrgHierarchy.getAllFilteredRootOrgsCnt=\
select count(*) from com.flexnet.platform.bizobjects.OrgUnit AS  ou,  com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy AS oh \
 left outer join ou.members_ as members left outer join members.contactId_ as contact where ou.id  NOT IN(:idList) and ou.id= oh.orgUnit.id and oh.parentOrgId is null AND oh.tenantId_=:tenantId

OrgHierarchy.getAllRootPortalOrgs=\
select ou from com.flexnet.platform.bizobjects.OrgUnit as ou, com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy as oh \
where ou.id= oh.orgUnit.id and oh.parentOrgId is null and ou.id IN (:idList) AND oh.tenantId_=:tenantId

OrgHierarchy.getAllRootPortalOrgsCnt=\
select count(*) from com.flexnet.platform.bizobjects.OrgUnit as ou, com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy as oh \
where ou.id= oh.orgUnit.id and oh.parentOrgId is null and ou.id IN (:idList) AND oh.tenantId_=:tenantId


OrgHierarchy.getAllRootOrgs=\
select ou from com.flexnet.platform.bizobjects.OrgUnit as ou, com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy as oh \
where ou.id= oh.orgUnit.id and oh.parentOrgId is null AND oh.tenantId_=:tenantId

OrgHierarchy.getAllRootOrgsCnt=\
select count(*) from com.flexnet.platform.bizobjects.OrgUnit as ou, com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy as oh \
where ou.id= oh.orgUnit.id and oh.parentOrgId is null AND oh.tenantId_=:tenantId

OrgHierarchy.getUsersAndRoles=\
select obj from UserOrgRole as obj  \
inner join obj.orgUnit as orgUnit \
inner join obj.user as user \
where orgUnit.id = ?  AND obj.tenantId_=:tenantId order by user.id

OrgHierarchy.getUsersAndRolesCnt=\
select count(*) from UserOrgRole as obj \
inner join obj.orgUnit as orgUnit \
inner join obj.user as user \
where orgUnit.id = ?  AND obj.tenantId_=:tenantId order by user.id

#Same query
#OrgHierarchy.getUsersAndRolesCnt=\
#select count(*) from UserOrgRole as obj \
#inner join obj.orgUnit as orgUnit \
#inner join obj.user as user \
#where orgUnit.id = ? order by user.id

OrgHierarchy.getUsersAndContacts=\
select contact.displayName_, user.userId_, contact.email_, contact.id, user.id,contact.firstName_, contact.lastName_ from \
com.flexnet.platform.bizobjects.Contact contact \
left outer join contact.userInfo_  as user \
inner join contact.belongsTo_ as orgContact \
inner join orgContact.orgUnitId_ as belongTo \
where belongTo.id = ? and (user.phantom_= 0 or user is null) AND contact.tenantId_=:tenantId

OrgHierarchy.getUsersAndContactsCnt=\
select count(contact.displayName_), user.userId_, contact.email_, contact.id, user.id from com.flexnet.platform.bizobjects.Contact contact \
left outer join contact.userInfo_  as user \
inner join contact.belongsTo_ as orgContact \
inner join orgContact.orgUnitId_ as belongTo \
where belongTo.id = ? and (user.phantom_= 0 or user is null) AND contact.tenantId_=:tenantId

OrgHierarchy.getRoleForUserInOrg=\
select uor.role.id from com.flexnet.platform.bizobjects.UserOrgRole as uor \
inner join uor.user as user \
inner join uor.orgUnit as org \
where user.id = ? AND org.id = ? AND uor.tenantId_=:tenantId

OrgHierarchy.getRolesForUsersInOrg=\
select uor.user.id, uor.role.id from com.flexnet.platform.bizobjects.UserOrgRole as uor \
inner join uor.user as user \
inner join uor.orgUnit as org \
where org.id = ? AND user.id IN (:idList) AND uor.tenantId_=:tenantId

OrgUnit.getBulkEntitlements=\
select bulkEnt from \
com.flexnet.operations.bizobjects.entitlements.BulkEntitlementBO as bulkEnt \
inner join bulkEnt.channelPartnerSet as partnerSet \
inner join partnerSet.channelPartners_ as partner \
inner join partner.orgUnit_ as org \
where org.id = ? AND bulkEnt.tenantId_=:tenantId

OrgHierarchy.isAncestor=\
select oh from com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy as oh \
inner join oh.orgUnit as orgUnit \
where (oh.lineage LIKE ? or oh.lineage LIKE ? ) \
and orgUnit.id IN (:idList) AND oh.tenantId_=:tenantId

OrgHierarchy.isChildOrganization=\
SELECT orgUnit FROM com.flexnet.operations.bizobjects.orghierarchy.OrgHierarchy as oh \
INNER JOIN oh.orgUnit as orgUnit \
WHERE oh.parentOrgId = ? and orgUnit.id = ? AND oh.tenantId_=:tenantId

OrgHierarchy.getUsersInTwoOrgs=\
select contact1.displayName_ from com.flexnet.platform.bizobjects.Contact contact1, com.flexnet.platform.bizobjects.Contact contact2 \
inner join contact1.belongsTo_ as orgContact1 inner join orgContact1.orgUnitId_ as orgunit1  \
inner join contact2.belongsTo_ as orgContact2 inner join orgContact2.orgUnitId_ as orgunit2 \
where orgunit1.id IN (:parentOrg) and orgunit2.id IN (:childOrg) and contact2.id = contact1.id AND contact2.tenantId_=:tenantId

OrgUnit.getProductCategories=\
select pdtcat from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.orgs_  as prodOrgCategory \
inner join prodOrgCategory.orgUnit_ as org \
where org.id = ? AND pdtcat.tenantId_=:tenantId


#Get all parent orgs for a given org
#XXXXX  sql
ExpiringEntitlementsJob.getParentOrgIds= WITH REC_NAME (PARENTORGID) AS ( \
   SELECT PARENTORGID FROM OPS_ORGHIERARCHY WHERE ORGID = :orgId AND TENANT_ID=:tenantId \
   UNION ALL \
   SELECT O.PARENTORGID FROM OPS_ORGHIERARCHY O, REC_NAME WHERE O.ORGID = REC_NAME.PARENTORGID  AND TENANT_ID=:tenantId \
) SELECT PARENTORGID FROM REC_NAME WHERE PARENTORGID IS NOT NULL
                
#XXXXX native sql
User.assignProductCategory=\
insert into OPS_USER_PDT_CATEGORY (PRODUCT_CATEGORY_ID, USER_ID,TENANT_ID) values (:productCatId, :userId, :tenantId)

User.getProductCategories=\
select pdtcat from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.users_  as pdcatusr \
inner join pdcatusr.userid  as usrers \
where usrers.id = ? AND pdtcat.tenantId_=:tenantId

User.getProductCategoriesIdByUserId=\
select pdtcat.id from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.users_  as pdcatusr \
inner join pdcatusr.userid  as usrers \
where usrers.id = ? AND pdtcat.tenantId_=:tenantId

User.existCategories=\
select pdtcat from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.users_  as pdcatusr \
inner join pdcatusr.userid  as usrers \
where usrers.id = ? \
and pdtcat.id != 0 AND pdtcat.tenantId_=:tenantId

Users.getAllProductCategories=\
select pdtcat from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.users_  as pdcatusr \
inner join pdcatusr.userid  as usrers \
where usrers.id IN (:idList) AND pdtcat.tenantId_=:tenantId

User.deleteProductCategory=\
delete from OPS_USER_PDT_CATEGORY where PRODUCT_CATEGORY_ID = ? and USER_ID = ? 

User.deleteAllProductCategories=\
delete from OPS_USER_PDT_CATEGORY where USER_ID = ? 

ProductCategory.getUsers=\
select usrers from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.users_  as pdcatusr \
inner join pdcatusr.userid  as usrers \
where pdtcat.id = ? AND pdtcat.tenantId_=:tenantId


ProductCategory.getUsersId=\
select usrers.userId_ from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.users_  as pdcatusr \
inner join pdcatusr.userid  as usrers \
where pdtcat.id = :prdcatId AND pdtcat.tenantId_=:tenantId


OrgUnit.getAllProductCategories=\
select pdtcat from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.orgs_  as prodOrgCategory \
inner join prodOrgCategory.orgUnit_ as org \
where org.id IN (:idList) AND pdtcat.tenantId_=:tenantId

OrgUnit.getProductCategory=\
select pdtcat from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.orgs_  as prodOrgCategory \
inner join prodOrgCategory.orgUnit_ as org \
where org.id = ? \
and pdtcat.id = ? AND pdtcat.tenantId_=:tenantId

Orderable.getProductCategory=\
select category from \
com.flexnet.products.bizobjects.Orderable as orderable \
inner join orderable.productCategory_  as category \
where orderable.id = ? AND orderable.tenantId_=:tenantId

ProductCategory.containedInOrgs=\
select org from \
com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
inner join pdtcat.orgs_  as prodOrgCategory \
inner join prodOrgCategory.orgUnit_ as org \
where pdtcat.id = ? AND pdtcat.tenantId_=:tenantId

OrgUnit.deleteAllProductCategories=\
delete from OPS_ORG_PRODUCT_CATEGORY where ORGUNIT_ID = ?

OrgUnit.removeProductCategories=\
delete from OPS_ORG_PRODUCT_CATEGORY where ORGUNIT_ID = ? and PRODUCT_CATEGORY_ID = ?

OrgUnit.deleteAllOrgsForProductCategory=\
delete from OPS_ORG_PRODUCT_CATEGORY where PRODUCT_CATEGORY_ID = ? and ORGUNIT_ID <> 1

ChannelPartnerSet.deleteAllChannelPartners=\
delete from OPS_ENT_PARTNER_TIER where CHANNEL_PARTNER_SET_ID = ? AND TENANT_ID=:tenantId

Entitlement.getSoldTo=\
select partner.orgUnit_ from \
com.flexnet.operations.bizobjects.entitlements.EntitlementBO as ent \
inner join ent.channelPartnerSet as partnerSet \
inner join partnerSet.channelPartners_ as partner \
inner join partner.partnerTier_ as partnerTier \
where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' AND ent.tenantId_=:tenantId

MaintenanceItemDO.getMaintenanceItemsBySoldTo = \
	select distinct item \
	from com.flexnet.operations.bizobjects.MaintenanceItemDO as item \
    inner join item.parentEntitlement_ as entitlement  \
    inner join entitlement.channelPartnerSet  as partnerSet \
    inner join partnerSet.channelPartners_ as partner \
    inner join partner.partnerTier_ as partnerTier \
    inner join partner.orgUnit_ as org  \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and org.id IN (:idList) AND item.tenantId_=:tenantId

MaintenanceItemDO.getMaintenanceItemsBySoldToCount = \
	select count(distinct item) \
	from com.flexnet.operations.bizobjects.MaintenanceItemDO as item \
    inner join item.parentEntitlement_ as entitlement  \
    inner join entitlement.channelPartnerSet  as partnerSet \
    inner join partnerSet.channelPartners_ as partner \
   MaintenanceItemDO.getMaintenanceItemsBySoldToCount inner join partner.partnerTier_ as partnerTier \
    inner join partner.orgUnit_ as org  \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and org.id IN (:idList) AND item.tenantId_=:tenantId

#XXXXX native sql
MaintenanceItemDO.addToLineItem =\
insert into OPS_MAINTENANCE_TO_ACTIVATABLE (MAINTENANCE_ITEM_ID, ACTIVATEABLE_ITEM_ID, TENANT_ID) values (:maintId, :actId, :tenantId)


MaintenanceItemDO.checkExistingId = \
	select count(*) from OPS_MAINTENANCE_TO_ACTIVATABLE where MAINTENANCE_ITEM_ID =:maintId and ACTIVATEABLE_ITEM_ID =:actId 




MaintenanceItemDO.getLinkedActivationId =  SELECT activatableItem1.activationID_ FROM com.flexnet.operations.bizobjects.MaintenanceItemDO as item \
											inner join item.activatableItems as activatableMaintenaceItem \
											inner join activatableMaintenaceItem.activatableItem as activatableItem1 \
											where item.id=? and activatableItem1.tenantId_=? and item.tenantId_=:tenantId
											
MaintenanceItemDO.getPartDetail = SELECT part.id, part.sku, part.description FROM com.flexnet.operations.bizobjects.MaintenanceItemDO as item \
											inner join item.sku_ as part where item.id=? and part.tenantId_=? and item.tenantId_=:tenantId


OpsOrgUnit.getOpsOrgUnit=\
select opsorgunit from \
com.flexnet.operations.bizobjects.orghierarchy.OpsOrgUnit as opsorgunit \
inner join opsorgunit.orgUnit_  as orgunit \
where orgunit.id = ? AND opsorgunit.tenantId_=:tenantId

# -------------End-------------------	
#------------User Service---------------------
UserService.getDistinctUserOrgs=\
select distinct obj.orgUnit.id from com.flexnet.platform.bizobjects.UserOrgRole as obj \
inner join obj.user as user \
where user.id = ? AND obj.tenantId_=:tenantId

UserService.getUserOrgRoles=\
from com.flexnet.platform.bizobjects.UserOrgRole as obj \
inner join obj.user as user \
inner join obj.orgUnit as org \
where user.id = ? and org.id =? AND obj.tenantId_=:tenantId
 
 
UserService.getRolesInOrgUnit=\
select obj.role from com.flexnet.platform.bizobjects.UserOrgRole as obj \
inner join obj.user as user \
inner join obj.orgUnit as org \
where user.id = ? and org.id =? AND obj.tenantId_=:tenantId

UserService.getAllRoles=\
from com.flexnet.platform.bizobjects.Role as obj WHERE obj.tenantId_=:tenantId

UserService.getAllRolesCnt=\
select count(*) from com.flexnet.platform.bizobjects.Role as obj WHERE obj.tenantId_=:tenantId

UserService.getAllPortalRoles=\
from com.flexnet.platform.bizobjects.Role as obj where obj.type_='PORTAL' AND obj.tenantId_=:tenantId

#XXXXX Un-Used
#UserService.getAllPortalRolesCnt=\
#select count(*) from com.flexnet.operations.bizobjects.RoleType as obj WHERE obj.null=:tenantId

UserService.getAllUsers=\
select contact from com.flexnet.platform.bizobjects.Contact contact \
left outer join contact.userInfo_  as user \
where user.phantom_= 0 or user is null AND contact.tenantId_=:tenantId

UserService.getAllUsersCnt=\
select count(contact) from com.flexnet.platform.bizobjects.Contact contact \
left outer join contact.userInfo_  as user \
where user.phantom_= 0 or user is null AND contact.tenantId_=:tenantId

UserService.getOrgsAndRoles=\
select obj from UserOrgRole as obj where obj.user.id = ?  AND obj.tenantId_=:tenantId order by obj.orgUnit.id

UserService.getOrgsAndRolesCnt=\
select count(*) from UserOrgRole as obj where obj.user.id = ?  AND obj.tenantId_=:tenantId order by obj.orgUnit.id

UserService.getBelongsToOrgs=\
select org from com.flexnet.platform.bizobjects.OrgUnit org join org.members_ as members join members.contactId_ as contact \
where contact.id = ? AND org.tenantId_=:tenantId

UserService.getBelongsToOrgsCnt=\
select count(org) from com.flexnet.platform.bizobjects.OrgUnit org join org.members_ as members join members.contactId_ as contact \
where contact.id = ? AND org.tenantId_=:tenantId

UserService.getUserOrgData=\
SELECT contact.id,contact.firstName_, contact.lastName_, contact.middleInitial_, contact.phone_, \
       contact.email_,  contact.displayName_, contact.fax_, contact.locale_, contact.streetAddress_, contact.city_, \
       contact.state_, contact.postalCode_, contact.country_, contact.timezone_, \
       user.id, user.userId_, user.active_ \
FROM com.flexnet.platform.bizobjects.Contact contact left outer join contact.userInfo_  as user  \
WHERE user.phantom_= 0 or user is null AND contact.tenantId_=:tenantId


UserService.getUserOrgDataCnt=\
SELECT count(contact.id) \
FROM com.flexnet.platform.bizobjects.Contact contact left outer join contact.userInfo_  as user \
WHERE user.phantom_= 0 or user is null AND contact.tenantId_=:tenantId


UserService.getContactOrgUnits=\
SELECT contact.id, org.id, org.name_, org.displayName_, org.description_, types.orgUnitType.name_ from com.flexnet.platform.bizobjects.OrgUnit org  join org.members_ as members join members.contactId_ as contact \
inner join org.types_ as types \
WHERE contact.id in (:idList) AND org.tenantId_=:tenantId

UserService.getUserOrgRolesTuplesAndExpiryDate=\
SELECT user.id, orgUnit.id, orgUnit.name_, orgUnit.displayName_, orgUnit.description_, types.orgUnitType.name_, role.id, role.name_, uor.expiryDate  \
FROM com.flexnet.platform.bizobjects.UserOrgRole as uor \
inner join uor.user as user \
inner join uor.orgUnit as orgUnit \
inner join uor.orgUnit.types_ as types \
inner join uor.role as role \
WHERE user.id in(:idList) AND uor.tenantId_=:tenantId

UserService.getUserAccountExpiryDate=\
SELECT DISTINCT uor.expiryDate \
FROM com.flexnet.platform.bizobjects.UserOrgRole as uor \
where uor.user = :userId and uor.tenantId_=:tenantId and uor.orgUnit in \
(select account.id from com.flexnet.platform.bizobjects.OrgUnit as account where account.name_ = :accountId)

Contact.getUser =\
SELECT obj FROM com.flexnet.platform.bizobjects.User as obj \
WHERE obj.contactInfo_ = :contactInfo and obj.tenantId_=:tenantId

User.getActivatableItems.Count=\
select count(activatableitem) from \
	com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as activatableitem \
	inner join activatableitem.belongsToUsers_ as belongTo \
	where belongTo.user.id = ?  AND activatableitem.tenantId_=:tenantId

User.getEntitlements.Count=\
select count(entitlement) from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.belongsToUsers_ as entUsr \
	inner join entUsr.user as belongTo \
  	where belongTo.id = ?  AND entitlement.tenantId_=:tenantId

User.getChannelPartners.Count=\
select count(channelpartner) from ChannelPartnerDO as channelpartner \
     inner join channelpartner.contact_ as contact \
     where contact.id = ? and channelpartner.tenantId_=:tenantId

User.getFulfillmentHistory.Count=\
select count(fh) from \
	com.flexnet.operations.bizobjects.FulfillmentHistoryBO as fh \
	where fh.userId = ?  AND fh.tenantId_=:tenantId

User.getHosts.Count=\
select count(host) from \
	com.flexnet.operations.bizobjects.HostEntityBO as host \
	where host.owner = ? AND host.tenantId_=:tenantId

User.getImportJobs.Count=\
select count(imp) from \
	com.flexnet.operations.bizobjects.ImportLegacyFulfillmentsRequestBO as imp \
	where imp.user = ? AND imp.tenantId_=:tenantId

User.getImportSkuJobs.Count=\
select count(imp) from \
	com.flexnet.operations.bizobjects.ImportSkusRequestBO as imp \
	where imp.user = ? AND imp.tenantId_=:tenantId

User.getShipmentRecords.Count=\
select count(ship) from \
	com.flexnet.operations.bizobjects.ShipmentRecordBO as ship \
	where ship.userId = ? AND ship.tenantId_=:tenantId

User.getStateChangeHistory.Count=\
select count(st) from \
	com.flexnet.products.bizobjects.StateChangeHistoryBO as st \
	where st.userId = ? AND st.tenantId_=:tenantId

User.getImportWRKRequests.Count = \
select count(wrk) from \
	com.flexnet.operations.bizobjects.entitlements.WebRegKeyImportRequestBO as wrk \
	where wrk.user = ? AND wrk.tenantId_=:tenantId

User.getAlertSubscriptions.Count= \
select count(alert) from \
	com.flexnet.platform.entities.AlertSubscription as alert \
	where alert.subscriber = ? AND alert.tenantId_=:tenantId

User.getAlertInbox.Count = \
select count(alert) from \
	com.flexnet.platform.entities.AlertInbox as alert \
	where alert.user = ? AND alert.tenantId_=:tenantId

User.deleteBelongsTo = \
DELETE FROM PLT_ORGUNIT_CONTACT WHERE CONTACTINFO_ID=:CONTACTINFO_ID AND (TENANT_ID=:tenantId or TENANT_ID is null)

Orgunit.existEntitlements =\
select count(entitlement) from \
	com.flexnet.operations.bizobjects.entitlements.EntitlementBO as entitlement \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.orgUnit_ as orgunit \
	where orgunit.id = ? AND entitlement.tenantId_=:tenantId

Orgunit.existHosts=\
select count(host) from \
	com.flexnet.operations.bizobjects.HostEntityBO as host \
	where host.soldTo = ? AND host.tenantId_=:tenantId
	
Orgunit.existCategories=\
select count(pdtcat) from \
	com.flexnet.products.bizobjects.ProductCategoryDO as pdtcat \
	inner join pdtcat.orgs_  as prodOrgCategory \
	inner join prodOrgCategory.orgUnit_ as org \
	where org.id = ? \
	and pdtcat.name_ != 'Uncategorized Products' AND pdtcat.tenantId_=:tenantId

OrgUnit.getContacts=\
select contact from \
	com.flexnet.platform.bizobjects.Contact as contact \
	inner join contact.belongsTo_ as orgContact inner join orgContact.orgUnitId_ as org \
	where org.id = ? AND contact.tenantId_=:tenantId

OrgUnit.deleteOrgHierarchyEntries=\
delete from OPS_ORGHIERARCHY where ORGID=? AND TENANT_ID=:tenantId

OrgUnit.deleteOpsOrgUnitEntries=\
delete from OPS_ORG_UNIT where ORG_ID=? AND TENANT_ID=:tenantId

OrgUnit.deleteRelatedOrgs=\
delete from OPS_RELATED_ORGS where OPS_ORG_ID=? or RELATED_OPS_ORG_ID = ? AND TENANT_ID=:tenantId

#no tenantId in PLT_PERMISSION
PermissionService.getAllPermissions=\
select role from com.flexnet.platform.bizobjects.Permission AS role

ActivationInstance.getActiveFulfillmentsOnHostForTransfer = \
    select instance from \
    com.flexnet.operations.bizobjects.ActivationInstance as instance \
    inner join instance.entitlementLineItem as lineitem \
    inner join lineitem.parentEntitlement_ as ent \
    inner join instance.hostEntity as h \
    where h.id = ? \
	and instance.lifeCycleStatus_ is null \
	and instance.status_ IN ('bo.constants.states.active', 'bo.constants.states.onhold') AND instance.tenantId_=:tenantId


# -------------End-------------------
 
# Reporting Queries
	
TransformationProcess.entityByName = \
	select childItem from \
	com.flexnet.operations.bizobjects.reporting.TransformEntity as childItem \
	inner join childItem.process_ as process \
	where process.id = ? and childItem.name_ = ? AND childItem.tenantId_=:tenantId
	
TransformationProcessDAO.getProcesses = \
	select distinct status from \
	com.flexnet.operations.bizobjects.reporting.TransformationProcess as status  WHERE status.tenantId_=:tenantId \
	ORDER BY LASTUPDATED DESC	
TransformationProcessDAO.getCountOfAllprocesses = \
	select count(distinct status) from \
	com.flexnet.operations.bizobjects.reporting.TransformationProcess as status WHERE status.tenantId_=:tenantId
	
#End of Reporting Queries
#
# Orderable queries
#
MaintenanceItem.validateUniqueNoId = \
	from com.flexnet.operations.bizobjects.MaintenanceItemDO as item \
	where item.activationID_ \= ? AND item.tenantId_=:tenantId

MaintenanceItem.validateUnique = \
	from com.flexnet.operations.bizobjects.MaintenanceItemDO as item \
	where item.activationID_ \= ? and item.id != ? AND item.tenantId_=:tenantId

BulkOpSpec.validateUniqueNoId = \
	from com.flexnet.operations.services.bulkOperations.BulkOperationSpecDO as bos \
	where bos.name_ \= ? AND bos.tenantId_=:tenantId

BulkOpSpec.validateUnique = \
	from com.flexnet.operations.services.bulkOperations.BulkOperationSpecDO as bos \
	where bos.name_ \= ? and bos.id != ? AND bos.tenantId_=:tenantId

#TODO: looks like unused, need to check
#BulkOpSpec.filterSearchCount= \
#	select count(*) from com.flexnet.products.bizobjects.ProductFeature as feature {0} {1}


BatchRehost.getProducts = \
select ord.id, ord.name_, ord.version_ from com.flexnet.products.bizobjects.Orderable as ord where ord.id IN (:idList) AND ord.tenantId_=:tenantId



LicenseTemplate.getLineItems = \
SELECT lineItem \
	from com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO as lineItem \
	inner join lineItem.parentEntitlement_ as entitlement \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and lineItem.status_ = 'bo.constants.states.deployed' and \
	lineItem.isBulkLineItem_ = false and entOrderableSet.productIds= ? and soldTo.id = ? and (licModel.id = ? \
	or altModel1.id = ? or altModel2.id = ?) AND lineItem.tenantId_=:tenantId

LicenseTemplate.getLineItemByActivationID= \
SELECT lineItem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as lineItem \
	inner join lineItem.parentEntitlement_ as entitlement \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	where lineItem.status_ = 'bo.constants.states.deployed' and \
	entOrderableSet.productIds= ? and soldTo.id = ? and (licModel.id = ? \
	or altModel1.id = ? or altModel2.id = ?) and lineItem.activationID_ = ? AND lineItem.tenantId_=:tenantId

LicenseTemplate.getLineItemByEntitlementID = \
SELECT lineItem \
	from com.flexnet.operations.bizobjects.entitlements.EntitlementLineItemBO as lineItem \
	inner join lineItem.parentEntitlement_ as entitlement \
	inner join lineItem.entitlementProduct_ as entProduct \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entitlement.channelPartnerSet as partnerSet \
	inner join partnerSet.channelPartners_ as partner \
	inner join partner.partnerTier_ as partnerTier \
	inner join partner.orgUnit_ as soldTo \
	inner join entProduct.licenseModel_ as licModel \
	left outer join entProduct.altLicenseModel1_ as altModel1 \
	left outer join entProduct.altLicenseModel2_ as altModel2 \
	where partnerTier.name = 'bo.constants.partnertiernames.endcustomer' \
	and lineItem.status_ = 'bo.constants.states.deployed' and \
	entOrderableSet.productIds= ? and soldTo.id = ? and (licModel.id = ? \
	or altModel1.id = ? or altModel2.id = ?) and entitlement.entitlementID_ = ? AND lineItem.tenantId_=:tenantId
	
		
#END: License template queries


#START Products queries
#
# Product Feature queries
#
ProductFeature.containedInBundles = \
	select bundle \
	from com.flexnet.products.bizobjects.FeatureBundle as bundle \
	inner join bundle.bundleItems as item \
	inner join item.feature as feature \
	where feature.id \= ? AND bundle.tenantId_=:tenantId
	
ProductFeature.containedInNonDraftBundles = \
	select bundle \
	from com.flexnet.products.bizobjects.FeatureBundle as bundle \
	inner join bundle.bundleItems as item \
	inner join item.feature as feature \
	where feature.id \= ? and bundle.status_ != 'bo.constants.states.draft' AND bundle.tenantId_=:tenantId
	
ProductFeature.containedInProducts = \
	select product \
	from com.flexnet.products.bizobjects.LicensedProduct as product \
	inner join product.licensedFeatures as item \
	inner join item.feature as feature \
	where feature.id \= ? AND product.tenantId_=:tenantId

ProductFeature.containedInNonDraftProducts= \
	select product \
	from com.flexnet.products.bizobjects.LicensedProduct as product \
	inner join product.licensedFeatures as item \
	inner join item.feature as feature \
	where feature.id \= ? and product.status_ != 'bo.constants.states.draft' AND product.tenantId_=:tenantId

ProductFeature.getDefault= \
	from com.flexnet.products.bizobjects.ProductFeature as feature \
	where feature.defaultObject_ \= true AND feature.tenantId_=:tenantId
#TODO looks like un-used, will come back again
#ProductFeature.filterSearch= \
#	from com.flexnet.products.bizobjects.ProductFeature as feature \
#	{0} {1} order by {2}
#TODO looks like un-used, will come back again
#ProductFeature.filterSearchCount= \
#	select count(*) from com.flexnet.products.bizobjects.ProductFeature as feature {0} {1}

ProductFeature.findFeature = \
	from com.flexnet.products.bizobjects.ProductFeature as feature \
		where feature.name_ = :name and feature.version_ = :version \
		and feature.defaultObject_ = false AND feature.tenantId_=:tenantId

ProductFeature.findFeatureByNameNullversion= \
	from com.flexnet.products.bizobjects.ProductFeature as feature \
		where feature.name_ = :name and feature.featureVersionFormat_='bo.constants.productFeature.featureVersionFormat.dateBased' \
		and feature.defaultObject_ = false AND feature.tenantId_=:tenantId
#TODO Don't know where is it used or how is it , will come back again
com.flexnet.products.bizobjects.ProductFeature.where= \
	obj.defaultObject_ = false
		

#
# FeatureBundle queries
#
FeatureBundle.containedInLicensedProducts = \
	select orderable \
	from com.flexnet.products.bizobjects.LicensedProduct as orderable \
	inner join orderable.licensedItems as item \
	inner join item.bundle as bundle \
	where bundle.id \= ? AND orderable.tenantId_=:tenantId

FeatureBundle.containedInNonDraftLicensedProducts= \
	select orderable \
	from com.flexnet.products.bizobjects.LicensedProduct as orderable \
	inner join orderable.licensedItems as item \
	inner join item.bundle as bundle \
	where bundle.id \= ? and orderable.status_ != 'bo.constants.states.draft' AND orderable.tenantId_=:tenantId

FeatureBundle.getDefault= \
	from com.flexnet.products.bizobjects.FeatureBundle as bundle \
	where bundle.defaultObject_ \= true AND bundle.tenantId_=:tenantId

FeatureBundle.getByName= \
	from com.flexnet.products.bizobjects.FeatureBundle as bundle \
	where bundle.name_ \= ?  AND bundle.tenantId_=:tenantId
#TODO Don't know where is it used or how is it , will come back again
com.flexnet.products.bizobjects.FeatureBundle.where= \
	obj.defaultObject_ = false
	
#
# Sku queries
#
Sku.getNamedSku = \
	from com.flexnet.products.bizobjects.Sku as sku \
	where sku.sku \= ? AND sku.tenantId_=:tenantId
	
#
# Unassigned Sku queries
#
#XXXXX removed com.flexnet.products.bizobjects.UnassignedSku
#UnassignedSku.getNamedSku = \
#	from com.flexnet.products.bizobjects.UnassignedSku as unassignedSku \
#	where unassignedSku.sku \= ? AND unassignedSku.null=:tenantId

#
# Orderable queries
#
Orderable.validateUnique = \
	from com.flexnet.products.bizobjects.Orderable as orderable \
	where orderable.name_ \= ? and orderable.version_ \= ? and orderable.orderableType \= ? \
	and orderable.optionName_ \= ? and orderable.revisionNumber \= ? AND orderable.tenantId_=:tenantId

Orderable.getDefault = \
	from com.flexnet.products.bizobjects.Orderable as orderable \
	where orderable.orderableType \= ? and orderable.defaultObject_ \= true AND orderable.tenantId_=:tenantId

Orderable.getReferringOrderables= \
	from com.flexnet.products.bizobjects.Orderable as orderable \
	inner join orderable.relatedOrderables as item \
	where item.relatedOrderable.id = ? AND orderable.tenantId_=:tenantId

Orderable.getReferringOrderablesWithRelation= \
	from com.flexnet.products.bizobjects.Orderable as orderable \
	inner join orderable.relatedOrderables as item \
	where item.relatedOrderable.id = ? and item.relationType = ? AND orderable.tenantId_=:tenantId
#TODO Don't know where is it used or how is it , will come back again
com.flexnet.products.bizobjects.Orderable.where= \
	obj.defaultObject_ = false
		
#
# LicensedProduct queries
#
LicensedProduct.getBundles = \
		select bundle \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licensedItems as item \
		inner join item.bundle as bundle \
		where orderable.id \= ? AND orderable.tenantId_=:tenantId
LicensedProduct.getBundlesCount = \
		select count(bundle) \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licensedItems as item \
		inner join item.bundle as bundle \
		where orderable.id \= ? AND orderable.tenantId_=:tenantId

LicensedProduct.getFeatures= \
		select feature \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licensedFeatures as item \
		inner join item.feature as feature \
		where orderable.id \= ? AND orderable.tenantId_=:tenantId

LicensedProduct.getFeaturesCount= \
		select count(feature) \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licensedFeatures as item \
		inner join item.feature as feature \
		where orderable.id \= ? AND orderable.tenantId_=:tenantId
		
	
LicensedProduct.filterReportingSearch= \
	from com.flexnet.products.bizobjects.LicensedProduct as orderable \
	{0} AND orderable.tenantId_=:tenantId order by {1}
#TODO used in code will come back again
LicensedProduct.filterReportingSearchCount= \
	select count(*) from com.flexnet.products.bizobjects.LicensedProduct as orderable {0}
	
#TODO Don't know where is it used or how is it , will come back again
com.flexnet.products.bizobjects.LicensedProduct.where= \
	obj.defaultObject_ = false

LicensedProduct.containedInSuites = \
	select suite \
	from com.flexnet.products.bizobjects.UniformSuite as suite \
	inner join suite.suiteItems as item \
	inner join item.licensedProduct as product \
	where product.id = ? AND suite.tenantId_=:tenantId

LicensedProduct.containedInSuiteIds = \
	select distinct suite.id  as id, suite.name_ as name_, suite.version_ as version_, suite.orderableType as orderableType, suite.status_ as status \
	from com.flexnet.products.bizobjects.UniformSuite as suite \
	inner join suite.suiteItems as item \
	inner join item.licensedProduct as product \
	where product.id in ( :ids ) AND suite.tenantId_=:tenantId
	
LicensedProduct.containedInNonDraftSuites = \
	select suite \
	from com.flexnet.products.bizobjects.UniformSuite as suite \
	inner join suite.suiteItems as item \
	inner join item.licensedProduct as product \
	where product.id = ? and suite.status_ != 'bo.constants.states.draft' AND suite.tenantId_=:tenantId

#
# UniformSuite queries
#
UniformSuite.getLicensedProducts = \
	select licensedProduct \
	from com.flexnet.products.bizobjects.UniformSuite as orderable \
	inner join orderable.suiteItems as item \
	inner join item.licensedProduct as licensedProduct \
	where orderable.id \= ? AND orderable.tenantId_=:tenantId
UniformSuite.getLicensedProductsCount = \
	select count(licensedProduct) \
	from com.flexnet.products.bizobjects.UniformSuite as orderable \
	inner join orderable.suiteItems as item \
	inner join item.licensedProduct as licensedProduct \
	where orderable.id \= ? AND orderable.tenantId_=:tenantId
#TODO Don't know where is it used or how is it , will come back again
com.flexnet.products.bizobjects.UniformSuite.where= \
	obj.defaultObject_ = false


#
# Maintenance queries
# 
Maintenance.getReferringLicensedProducts = \
	select orderable \
	from com.flexnet.products.bizobjects.LicensedProduct as orderable \
	where orderable.maintenance.id \= ? AND orderable.tenantId_=:tenantId
	
#TODO Don't know where is it used or how is it , will come back again	
com.flexnet.products.bizobjects.Maintenance.where= \
	obj.defaultObject_ = false

#
# License Model queries
#
LicenseModel.getByName = \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	where model.name = ? AND model.tenantId_=:tenantId
	
LicenseModel.getReferringLicensedProducts = \
	select orderable \
	from com.flexnet.products.bizobjects.LicensedProduct as orderable \
	inner join orderable.licModels as licModels \
	inner join licModels.licenseModel_ as model \
  	where model.id = ? AND orderable.tenantId_=:tenantId

LicenseModel.getReferringSuites = \
	select orderable \
	from com.flexnet.products.bizobjects.UniformSuite as orderable \
	inner join orderable.licModels as licModels \
	inner join licModels.licenseModel_ as model \
  	where model.id = ?	 AND orderable.tenantId_=:tenantId

LicenseModel.getReferringNonDraftLicensedProducts = \
	select orderable \
	from com.flexnet.products.bizobjects.LicensedProduct as orderable \
	inner join orderable.licModels as licModels \
	inner join licModels.licenseModel_ as model \
  	where model.id = ? and orderable.status_ != 'bo.constants.states.draft' AND orderable.tenantId_=:tenantId

LicenseModel.getReferringNonDraftSuites = \
	select orderable \
	from com.flexnet.products.bizobjects.UniformSuite as orderable \
	inner join orderable.licModels as licModels \
	inner join licModels.licenseModel_ as model \
  	where model.id = ? and orderable.status_ != 'bo.constants.states.draft' AND orderable.tenantId_=:tenantId
LicenseModel.getReferringPartNo = \
	select sku \
	from com.flexnet.products.bizobjects.Sku as sku \
	inner join sku.licenseModel as model \
	where model.id = ?	 AND sku.tenantId_=:tenantId
	
#
# Recently accessed queries
#
RecentlyAccessed.getItemCountByType = \
	select count(*) from com.flexnet.products.bizobjects.RecentlyAccessed as ra \
	where ra.type=:type and ra.changedBy=:changedBy and ra.itemId!=:itemId AND ra.tenantId_=:tenantId
	

RecentlyAccessed.getByType = \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra \
	where ra.type=:type and ra.changedBy=:changedBy  AND ra.tenantId_=:tenantId order by ra.lastModified

RecentlyAccessed.getByItem = \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra \
	where ra.type=:type and ra.changedBy=:changedBy and ra.itemId=:itemId AND ra.tenantId_=:tenantId

UniformSuite.getRecentlyAccessed=\
	select orderable \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.UniformSuite as orderable \
	where orderable.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.UniformSuite' \
	and ra.changedBy=? AND orderable.tenantId_=:tenantId

UniformSuite.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.UniformSuite as orderable \
	where orderable.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.UniformSuite' \
	and ra.changedBy=? AND orderable.tenantId_=:tenantId

LicensedProduct.getRecentlyAccessed=\
	select orderable \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.LicensedProduct as orderable \
	where orderable.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.LicensedProduct' \
	and ra.changedBy=? AND orderable.tenantId_=:tenantId
	
Orderable.getRecentlyAccessed=\
	select orderable \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.Orderable as orderable \
	where orderable.id=ra.itemId \
	and (ra.type='com.flexnet.products.bizobjects.LicensedProduct' OR \
	ra.type='com.flexnet.products.bizobjects.UniformSuite' OR \
	ra.type='com.flexnet.products.bizobjects.Maintenance') \
	and ra.changedBy=? AND orderable.tenantId_=:tenantId

Orderable.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.Orderable as orderable \
	where orderable.id=ra.itemId \
	and (ra.type='com.flexnet.products.bizobjects.LicensedProduct' OR \
	ra.type='com.flexnet.products.bizobjects.UniformSuite' OR \
	ra.type='com.flexnet.products.bizobjects.Maintenance') \
	and ra.changedBy=? AND orderable.tenantId_=:tenantId

LicensedProduct.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.LicensedProduct as orderable \
	where orderable.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.LicensedProduct' \
	and ra.changedBy=? AND orderable.tenantId_=:tenantId

ProductFeature.getRecentlyAccessed=\
	select feature \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.ProductFeature as feature \
	where feature.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.ProductFeature' \
	and ra.changedBy=? AND feature.tenantId_=:tenantId

ProductFeature.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.ProductFeature as feature \
	where feature.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.ProductFeature' \
	and ra.changedBy=? AND feature.tenantId_=:tenantId

FeatureBundle.getRecentlyAccessed=\
	select bundle \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.FeatureBundle as bundle \
	where bundle.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.FeatureBundle' \
	and ra.changedBy=? AND bundle.tenantId_=:tenantId

FeatureBundle.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.FeatureBundle as bundle \
	where bundle.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.FeatureBundle' \
	and ra.changedBy=? AND bundle.tenantId_=:tenantId

LicenseModelBO.getRecentlyAccessed=\
	select model \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.LicenseModelBO as model \
	where model.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.LicenseModelBO' \
	and ra.changedBy=? AND model.tenantId_=:tenantId

LicenseModelBO.getRecentlyAccessedCount=\
	select count(*) \
	from com.flexnet.products.bizobjects.RecentlyAccessed as ra, \
	com.flexnet.products.bizobjects.LicenseModelBO as model \
	where model.id=ra.itemId and ra.type='com.flexnet.products.bizobjects.LicenseModelBO' \
	and ra.changedBy=? AND model.tenantId_=:tenantId

LicenseTechnology.getByName = \
	from com.flexnet.products.bizobjects.LicenseTechnologyBO as bo \
	where bo.name_ \= ? AND bo.tenantId_=:tenantId

LicenseTechnology.getByTenantId= \
	from com.flexnet.products.bizobjects.LicenseTechnologyBO as bo \
	where bo.tenantId_ \= ? AND bo.tenantId_=:tenantId

LicenseGeneratorConfig.getByPK= \
	from com.flexnet.products.bizobjects.LicenseGeneratorConfigBO as bo \
	where bo.name_ = ? and bo.licenseTechnology_ = ? AND bo.tenantId_=:tenantId

LicenseTechnology.containedInLicenseModels = \
	select model \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	inner join model.licenseTechnology_ as tech \
	where tech.id \= ? AND model.tenantId_=:tenantId
	
LicenseTechnology.containedInNonDraftLicenseModels = \
	select model \
	from com.flexnet.products.bizobjects.LicenseModelBO as model \
	inner join model.licenseTechnology_ as tech \
	where tech.id \= ? and model.status_ != 'bo.constants.states.draft' AND model.tenantId_=:tenantId
	
LicenseTechnology.containedInProducts = \
	select ord \
	from com.flexnet.products.bizobjects.LicensedProduct as ord \
	inner join ord.licenseTechnology_ as tech \
	where tech.id \= ? AND ord.tenantId_=:tenantId
	
LicenseTechnology.containedInNonDraftProducts = \
	select ord \
	from com.flexnet.products.bizobjects.LicensedProduct as ord \
	inner join ord.licenseTechnology_ as tech \
	where tech.id \= ? and ord.status_ != 'bo.constants.states.draft'	 AND ord.tenantId_=:tenantId
	
LicenseTechnology.containedInSuites = \
	select ord \
	from com.flexnet.products.bizobjects.UniformSuite as ord \
	inner join ord.licenseTechnology_ as tech \
	where tech.id \= ? AND ord.tenantId_=:tenantId
	
LicenseTechnology.containedInNonDraftSuites = \
	select ord \
	from com.flexnet.products.bizobjects.UniformSuite as ord \
	inner join ord.licenseTechnology_ as tech \
	where tech.id \= ? and ord.status_ != 'bo.constants.states.draft' AND ord.tenantId_=:tenantId
		
LicenseTechnology.containedInGenerators = \
	select gen \
	from com.flexnet.products.bizobjects.LicenseGeneratorConfigBO as gen \
	inner join gen.licenseTechnology_ as tech \
	where tech.id \= ?	 AND gen.tenantId_=:tenantId
LicenseGeneratorConfig.containedInProducts = \
	select ord \
	from com.flexnet.products.bizobjects.LicensedProduct as ord \
	inner join ord.licenseGenerator_ as gen \
	where gen.id \= ? AND ord.tenantId_=:tenantId
LicenseGeneratorConfig.containedInSuites = \
	select ord \
	from com.flexnet.products.bizobjects.UniformSuite as ord \
	inner join ord.licenseGenerator_ as gen \
	where gen.id \= ? AND ord.tenantId_=:tenantId

LicenseGeneratorConfig.hasFulfillments = \
	select fulfillment from \
	com.flexnet.operations.bizobjects.ActivationInstance as fulfillment \
	inner join fulfillment.entitlementLineItem as lineItem \
	inner join lineItem.entitledOrderableSet as entOrderableSet \
	inner join entOrderableSet.entitledOrderables_ as entOrderable \
	inner join entOrderable.orderable as orderable \
	where lineItem.status_ != 'bo.constants.states.test' and orderable.licenseGenerator_= ?  AND fulfillment.tenantId_=:tenantId
	
ProductFeature.getFeaturesInAllBundles = \
	select distinct feature \
		from com.flexnet.products.bizobjects.FeatureBundle as bundle \
		inner join bundle.bundleItems as item \
		inner join item.feature as feature  WHERE bundle.tenantId_=:tenantId order by feature.id

ProductFeature.getCountOfFeaturesInAllBundles = \
	select count(distinct feature) \
		from com.flexnet.products.bizobjects.FeatureBundle as bundle \
		inner join bundle.bundleItems as item \
		inner join item.feature as feature WHERE bundle.tenantId_=:tenantId

FeatureBundle.getFeatureBundlesInAllProducts = \
	select distinct bundle \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licensedItems as item \
		inner join item.bundle as bundle  WHERE orderable.tenantId_=:tenantId order by bundle.id

FeatureBundle.getCountOfFeatureBundlesInAllProducts = \
	select count(distinct bundle) \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licensedItems as item \
		inner join item.bundle as bundle WHERE orderable.tenantId_=:tenantId
		
LicenseModel.getLicenseModelsInAllProducts = \
	select distinct model \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licModels as licModels inner join licModels.licenseModel_ as model WHERE orderable.tenantId_=:tenantId order by model.id

LicenseModel.getCountOfLicenseModelsInAllProducts = \
	select count(distinct model) \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.licModels as licModels inner join licModels.licenseModel_ as model WHERE orderable.tenantId_=:tenantId

Sku.getSkusInAllProducts = \
	select distinct sku \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.skus as sku  WHERE orderable.tenantId_=:tenantId order by sku.id

Sku.getCountOfSkusInAllProducts = \
	select count(distinct sku) \
		from com.flexnet.products.bizobjects.LicensedProduct as orderable \
		inner join orderable.skus as sku WHERE orderable.tenantId_=:tenantId

LicenseTechnologyHostAttribute.getHostAttributesForTechnology = \
	select hostAttr \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as hostAttr \
	where licenseTechnology_.id \= ? AND hostAttr.tenantId_=:tenantId
	
LicenseTechnologyHostAttribute.getHostAttributesForTechnologyAndHost = \
	select hostAttr \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as hostAttr \
	where hostType_.id \= ?	 AND hostAttr.tenantId_=:tenantId

# Added by Shalu	
LicenseTechnologyHostAttribute.getHostAttributesForHost = \
	select hostAttr \
	from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as hostAttr \
	where hostType_.id \= ?	 AND hostAttr.tenantId_=:tenantId

#END Products queries

#START TransactionHistory aka AuditTrail 

AuditTrail.getAuditTrailRecordsByComboDesc = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entityType in (:typeList)  \
							and (:entityValue is null OR auditTrail.entityValue= :entityValue ) \
							and (:entity_id =0 OR auditTrail.entity_id= :entity_id ) \
							and (:userId is null OR auditTrail.userId= :userId ) \
							and (:start is null OR auditTrail.datetime \> :start) \
							and (:end is null OR auditTrail.datetime \< :end) order by auditTrail.datetime desc

AuditTrail.getAuditTrailRecordsByComboAsc = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entityType in (:typeList)  \
							and (:entityValue is null OR auditTrail.entityValue= :entityValue ) \
							and (:entity_id =0 OR auditTrail.entity_id= :entity_id ) \
							and (:userId is null OR auditTrail.userId= :userId ) \
							and (:start is null OR auditTrail.datetime \> :start) \
							and (:end is null OR auditTrail.datetime \< :end) order by auditTrail.datetime asc

AuditTrail.getAuditTrailRecordsByCombo = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entityType in (:typeList)  \
							and (:entityValue is null OR auditTrail.entityValue= :entityValue ) \
							and (:entity_id =0 OR auditTrail.entity_id= :entity_id ) \
							and (:userId is null OR auditTrail.userId= :userId ) \
							and (:start is null OR auditTrail.datetime \> :start) \
							and (:end is null OR auditTrail.datetime \< :end) 

AuditTrail.maxRecords = select count(*) from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entityType in (:typeList)  \
							and (:entityValue is null OR auditTrail.entityValue= :entityValue ) \
							and (:entity_id =0 OR auditTrail.entity_id= :entity_id ) \
							and (:userId is null OR auditTrail.userId= :userId ) \
							and (:start is null OR auditTrail.datetime \> :start) \
							and (:end is null OR auditTrail.datetime \< :end) 

###Access Token Queries
AccessToken.getAccessTokensForUser = select * from PLT_USER_TOKEN as at \
                            where at.tenant_id = CONVERT(nvarchar(255), :tenantId) and at.userid = :userid \
                            and at.expiry_date > :currenttime \
                            order by at.token_issue_date

AccessToken.getAccessTokenCountForUser = select count(*) from PLT_USER_TOKEN as at \
                            where at.tenant_id = CONVERT(nvarchar(255), :tenantId) and at.userid = :userid \
                            and at.expiry_date > :currenttime 

AccessToken.deleteExpiredTokens = delete from PLT_USER_TOKEN as at \
                            where at.expiry_date < :expiry_date;


###Audit Detail Queries
AuditTrail.getAuditPredecessor = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entity_id = :entity_id \
							and auditTrail.entityType = :entityType \
							and auditTrail.datetime <= :end  order by auditTrail.datetime desc
							
AuditTrail.getAuditPredecessorWithoutDtParam = select top(2) * from OPS_AUDITTRAIL as auditTrail \
							where auditTrail.tenant_Id = :tenantId and auditTrail.entity_id = :entity_id \
							and auditTrail.entity_Type = :entityType \
							order by auditTrail.id desc							
							
AuditTrail.getAuditPredecessorById = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entity_id = :entity_id \
							and auditTrail.id <= :id \
							and auditTrail.entityType = :entityType order by auditTrail.datetime desc, auditTrail.id desc
AuditTrail.getAuditPredecessorByIdWithEnt = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.tenantId = :tenantId and auditTrail.entity_id = :entity_id \
							and auditTrail.id <= :id \
                            and (auditTrail.entityType = :entityType OR auditTrail.eventType = 'CREATE') order by auditTrail.datetime desc, auditTrail.id desc


AuditTrail.getAuditPredecessorEntitiesById = select auditTrail from com.flexnet.operations.bizobjects.AuditTrailBO as auditTrail \
							where auditTrail.id = :id AND auditTrail.tenantId=:tenantId

#END TransactionHistory aka AuditTrail 

BrandItemDO.getByItemType = select brandItem from com.flexnet.operations.branding.bizobjects.BrandItemDO \
	as brandItem where brandItem.fileType \= :itemType and brandItem.tenantId \= :tenantId 
	
BrandItemDO.getAll = select brandItem from com.flexnet.operations.branding.bizobjects.BrandItemDO \
	as brandItem where brandItem.tenantId \= :tenantId
	
EmailEvent.getEvents = select emailEvent from com.flexnet.operations.bizobjects.administer.EmailEventBO as emailEvent \
                       where emailEvent.status \= :status order by emailEvent.email_event_nm asc

EmailTemplate.getEmailTemplate = select emailTemplate, emailTemplateVersion from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
								where emailTemplate.email_tpl_id \= ? and emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id AND emailTemplateVersion.tenant_id=:tenantId
																
EmailTemplate.getActiveEmailTemplate = select emailTemplate, emailTemplateVersion from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
								where emailTemplate.email_tpl_id \= ? and emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id and \
								emailTemplateVersion.active_date is not null AND emailTemplateVersion.tenant_id=:tenantId

EmailEvent.getEmailEventMergeTags = select emailMergeTag, emailEventMergeTag from com.flexnet.operations.bizobjects.administer.EmailMergeTagBO \
								as emailMergeTag inner join emailMergeTag.emailMergeTagEvents_ as emailEventMergeTag \
								where emailEventMergeTag.email_event_id \= ?

EmailTemplate.getEmailTemplatesByTenant = select emailTemplate, emailTemplateVersion from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate , com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
								where emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id \
								 AND emailTemplateVersion.tenant_id=:tenantId order by emailTemplate.email_tpl_id asc
								
								
EmailToTemplate.getEmailToTemplatesByTemplateId = select emailToTemplates from com.flexnet.operations.bizobjects.administer.EmailToTemplateBO as emailToTemplates \
												  where emailToTemplates.email_tpl_id \= ?	 AND emailToTemplates.tenant_id=:tenantId
												  
EmailTemplate.getMaxEmailTemplateId= SELECT MAX(email_tpl_id) from com.flexnet.operations.bizobjects.administer.EmailTemplateBO	 WHERE TENANT_ID=:tenantId

EmailTemplateVersion.getMaxEmailTemplateVersionId= SELECT MAX(email_tpl_ver_id) from com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO	 WHERE TENANT_ID=:tenantId

EmailTemplate.getEmailTemplateVersion= select emailTemplate, emailTemplateVersion, emailContent from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
										as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion, \
										com.flexnet.operations.bizobjects.administer.EmailContentBO as emailContent \
										where emailTemplate.email_tpl_id \= ? and emailTemplateVersion.email_tpl_ver_id \= ? and \
										emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id and \
										emailTemplateVersion.email_tpl_ver_id = emailContent.email_tpl_ver_id AND emailContent.tenant_id=:tenantId

EmailTemplate.getMaxEmailTemplateVersionNumber= SELECT MAX(emailTemplateVersion.ver_num) from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
									  			as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
												where emailTemplate.email_tpl_id \= ? and emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id AND emailTemplateVersion.tenant_id=:tenantId


EmailTemplate.getActiveTemplateVersion = SELECT emailTemplateVersion.email_tpl_ver_id from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
									  	 as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
										 where emailTemplate.email_tpl_id \= ? and emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id and \
										 emailTemplateVersion.active_date is not null AND emailTemplateVersion.tenant_id=:tenantId
												
EmailTemplate.getDraftTemplateVersion = SELECT emailTemplateVersion.email_tpl_ver_id from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
									  	 as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
										 where emailTemplate.email_tpl_id \= ? and emailTemplate.email_tpl_id = emailTemplateVersion.email_tpl_id and \
										 emailTemplateVersion.active_date is null and emailTemplateVersion.archive_date is null AND emailTemplateVersion.tenant_id=:tenantId

EmailTemplateVersion.getEmailTemplateVersion= select emailTemplateVersion from com.flexnet.operations.bizobjects.administer.EmailTemplateVersionBO as emailTemplateVersion \
											  where emailTemplateVersion.email_tpl_ver_id \= ? AND emailTemplateVersion.tenant_id=:tenantId
																	  							
EmailContent.getEmailContentByVersion = select emailContent from com.flexnet.operations.bizobjects.administer.EmailContentBO as emailContent \
									    where emailContent.email_tpl_ver_id \= ? AND emailContent.tenant_id=:tenantId
									    
EmailTemplate.getEmailTemplateCount= select count(*) from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate where emailTemplate.var_nm \= ? and emailTemplate.email_event_id \= ?  AND emailTemplate.tenant_id=:tenantId
								
								
EmailTemplate.getEmailTemplateByEventIdTenantIdVarName = select emailTemplate from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate where emailTemplate.var_nm \= ? and emailTemplate.email_event_id \= ? 	AND emailTemplate.tenant_id=:tenantId

EmailTemplate.getEmailTemplateByEventCodeTenantIdVarName = select emailTemplate from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailEventBO as emailEvent \
								where emailEvent.email_event_cd \= ? and emailEvent.email_event_id \= emailTemplate.email_event_id \
								and emailTemplate.var_nm \= ? and emailTemplate.email_tpl_ver_id is not null AND emailTemplate.tenant_id=:tenantId
								
EmailContent.getEmailContentByVersionAndLanguageCode= select emailContent from com.flexnet.operations.bizobjects.administer.EmailContentBO as emailContent \
									    where emailContent.email_tpl_ver_id \= ? and emailContent.lang_cd \= ? AND emailContent.tenant_id=:tenantId
									    
EmailTemplate.getEmailTemplateByEventCodeTenantId = select emailTemplate from com.flexnet.operations.bizobjects.administer.EmailTemplateBO \
								as emailTemplate, com.flexnet.operations.bizobjects.administer.EmailEventBO as emailEvent \
								where emailEvent.email_event_cd \= ? and emailEvent.email_event_id \= emailTemplate.email_event_id \
								and emailTemplate.email_tpl_ver_id is not null AND emailTemplate.tenant_id=:tenantId		
								
BaseProduct.getBaseProductByOrderableId= select baseProduct from com.flexnet.operations.bizobjects.BaseProductDO as baseProduct inner join baseProduct.orderable as orderable where orderable.id= :orderableId AND baseProduct.tenantId=:tenantId

    
LicenseModelAttribute.getReportingOrderCount=select \
		 attr.reportingOrder from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as attr  \
		 where attr.neededForReporting <> 0 and attr.tenantId_\=\:tenant_name AND attr.tenantId_=:tenantId
		 
LicenseModelAttribute.getExistingReportingOrderNumber=select \
		 attr.reportingOrder from com.flexnet.products.bizobjects.LicenseTechnologyAttributeBO as attr  \
		 where attr.attributeName=:name and attr.attributeNameSpace=:attribute_namespace and  attr.tenantId_\=\:tenant_name  AND attr.tenantId_=:tenantId
		 
CustomHostAttribute.getReportingOrderCount=select \
		 attr.reportingOrder from com.flexnet.products.bizobjects.LicenseTechnologyHostAttributeBO as attr  \
		 where attr.neededForReporting <> 0 and attr.tenantId_\=\:tenant_name AND attr.tenantId_=:tenantId

#Native SQL
LicenseModelAttribute.getLastReportingOrder = WITH \
		metaData_reference ( Name ) AS  \
    ( \
         SELECT DISTINCT NAME FROM plt_extpropmetadata where className in ('com.flexnet.products.bizobjects.LicenseModelBO','com.flexnet.operations.bizobjects.ActivationInstance','com.flexnet.operations.bizobjects.entitlements.EntitlementProductBO') AND TENANT_ID=:tenantId \
    ) \
select (CASE WHEN count(*) < 30 THEN 'true' WHEN count(*) >=  30 THEN 'false' END) \
from ops_lic_technology_attribute t1 join  metaData_reference t2 on t1.attribute_name=t2.Name \
where t1.for_reporting=:neededForReporting and t1.tenant_id = :tenant_name

EmailTemplate.emailRecipientsForTenant = select recipients from com.flexnet.operations.bizobjects.administer.EmailHistoryRecipientsBO as recipients \
where tenantId \= :tenantId

ExpiringEntitlements.getOrgsForExpiringEntitlements = select  distinct orgUnit.ID as soldToOrgId \
    from OPS_ACTIVATABLE_ITEM lineItem inner join OPS_ENTITLEMENT_PRODUCT entitlement on lineItem.ENTITLEMENT_PRODUCT_ID \= entitlement.ID \
    inner join OPS_ENTITLEMENT_ORDER entitlementOrder on lineItem.PARENT_ENTITLEMENT_ID \= entitlementOrder.ID \
    inner join OPS_CHANNEL_PARTNER_SET channelPartner3 on entitlementOrder.CHANNEL_PARTNER_SET \= channelPartner3.ID \
    inner join OPS_ENT_PARTNER_TIER channelPartner4 on channelPartner3.ID \= channelPartner4.CHANNEL_PARTNER_SET_ID \
    inner join OPS_PARTNER_TIER_NAME partnertie5_ on channelPartner4.PARTNER_TIER_ID \= partnertie5_.ID \
    inner join PLT_ORGUNIT orgUnit on channelPartner4.ORG_UNIT_ID \= orgUnit.ID \
    where lineItem.ACTIVATABLE_ITEM_TYPE in ('bo.constants.activatableitem.type.entitlement_line_item') \
    and entitlement.VALID_UNTIL \= :expiryDate and lineItem.STATUS='bo.constants.states.deployed' \
    and entitlementOrder.STATUS \= 'bo.constants.states.deployed' and lineItem.IS_BULK_LINE_ITEM <> 1 and orgUnit.NAME <> 'UNKNOWN_ORG_UNIT' AND lineItem.TENANT_ID=:tenantId

ExpiringEntitlements.getExpiringEntitlements= select  lineItem.ACTIVATION_ID as entitlementId, entitlementOrder.ENTITLEMENT_ID as orderId, \
	entitlement.VALID_UNTIL as expirationDate, orgUnit.NAME as orgName from OPS_ACTIVATABLE_ITEM lineItem \
	inner join OPS_ENTITLEMENT_PRODUCT entitlement on lineItem.ENTITLEMENT_PRODUCT_ID=entitlement.ID \
    inner join OPS_ENTITLEMENT_ORDER entitlementOrder on lineItem.PARENT_ENTITLEMENT_ID=entitlementOrder.ID \
	inner join OPS_CHANNEL_PARTNER_SET channelPartner3 on entitlementOrder.CHANNEL_PARTNER_SET=channelPartner3.ID \
    inner join OPS_ENT_PARTNER_TIER channelPartner4 on channelPartner3.ID=channelPartner4.CHANNEL_PARTNER_SET_ID \
    inner join OPS_PARTNER_TIER_NAME partnerTier on channelPartner4.PARTNER_TIER_ID=partnerTier.ID \
    inner join PLT_ORGUNIT orgUnit on channelPartner4.ORG_UNIT_ID=orgUnit.ID \
    where lineItem.ACTIVATABLE_ITEM_TYPE in ('bo.constants.activatableitem.type.entitlement_line_item') \
    and (entitlement.VALID_UNTIL >= :today AND entitlement.VALID_UNTIL <= :lookAhead) \
	and lineItem.STATUS='bo.constants.states.deployed' and entitlementOrder.STATUS='bo.constants.states.deployed' \
    and lineItem.IS_BULK_LINE_ITEM<>1 and orgUnit.ID = :orgId  AND lineItem.TENANT_ID=:tenantId order by expirationDate asc

Organisation.getOrganisationForEmails=SELECT contact FROM  com.flexnet.platform.bizobjects.Contact contact WHERE email_ IN (:idListOrg) AND contact.tenantId_=:tenantId


#-------- Account Health <-> get distinct products count per Account
AccountHealth.getProductCountPerAccount=SELECT feature.account.id,count(distinct feature.product) FROM com.flexnet.operations.bizobjects.health.FeatureUsageDetail as feature \
	WHERE  feature.account IN (:ids) group by feature.account.id \
	
AccountHealth.getAccountHealthScoresHistory=SELECT historyObjs from com.flexnet.operations.bizobjects.health.AccountHealthScoresHistory as historyObjs \
	WHERE  belongsToOrg_.id =:id and updatedOn >= (current_timestamp - 30) 

#Native SQL
AccountHealth.getSegmentsAndScoresData = select count(CASE WHEN health_score< :healthLow THEN 1 END) AS LOW_HEALTH, \
	count(CASE WHEN health_score>= :healthLow AND health_score < :healthHigh THEN 1 END) AS MEDIUM_HEALTH, \
	count(CASE WHEN health_score>= :healthHigh THEN 1 END) AS HIGH_HEALTH, \
	count(CASE WHEN renewal_score< :renewalLow THEN 1 END) AS LOW_RENEWAL, \
	count(CASE WHEN renewal_score>= :renewalLow AND renewal_score < :renewalHigh THEN 1 END) AS MEDIUM_RENEWAL, \
	count(CASE WHEN renewal_score>= :renewalHigh THEN 1 END) AS HIGH_RENEWAL, \
	count(CASE WHEN consumption_score< :consumptionLow THEN 1 END) AS LOW_CONSUMPTION, \
	count(CASE WHEN consumption_score>= :consumptionLow AND consumption_score < :consumptionHigh THEN 1 END) AS MEDIUM_CONSUMPTION, \
	count(CASE WHEN consumption_score>= :consumptionHigh THEN 1 END) AS HIGH_CONSUMPTION, \
	AVG(health_score) AS AVG_HEALTH, \
	AVG(renewal_score) AS AVG_RENEWAL, \
	AVG(consumption_score) AS AVG_CONSUMPTION from OPS_HEALTH_SCORES_HISTORY this_ \
	inner join PLT_ORGUNIT orgunit1_ on this_.BELONGSTO_ORG_ID=orgunit1_.ID \
    inner join PLT_ORGUNIT_ORGUNITTYPE types_5_ on orgunit1_.ID=types_5_.ORGUNIT_ID \
    inner join PLT_ORGUNITTYPE orgunittyp2_ on types_5_.ORGUNITTYPE_ID=orgunittyp2_.ID \
    where this_.LAST_MODIFIED = ( \
             select max(historyObjTemp_.LAST_MODIFIED) as y0_ \
             from OPS_HEALTH_SCORES_HISTORY historyObjTemp_ \
             where historyObjTemp_.BELONGSTO_ORG_ID=this_.BELONGSTO_ORG_ID ) \
         and orgunittyp2_.ID= :orgUnitTypeId and orgunit1_.TENANT_ID= :tenantID  
  
 AccountHealth.getPreviousScoresData= select avg(health_score) AS AVG_HEALTH,avg(renewal_score) AS AVG_RENEWAL,avg(consumption_score) AS AVG_CONSUMPTION \
 from OPS_HEALTH_SCORES_HISTORY this_ \
     inner join PLT_ORGUNIT orgunit1_ on this_.BELONGSTO_ORG_ID=orgunit1_.ID \
     inner join PLT_ORGUNIT_ORGUNITTYPE types_5_ on orgunit1_.ID=types_5_.ORGUNIT_ID \
     inner join PLT_ORGUNITTYPE orgunittyp2_ on types_5_.ORGUNITTYPE_ID=orgunittyp2_.ID \
     where this_.LAST_MODIFIED = (select max(historyObjTemp2_.LAST_MODIFIED) FROM  OPS_HEALTH_SCORES_HISTORY historyObjTemp2_ \
     							where historyObjTemp2_.BELONGSTO_ORG_ID=this_.BELONGSTO_ORG_ID and  historyObjTemp2_.LAST_MODIFIED < ( \
     							            select max(historyObjTemp_.LAST_MODIFIED) as y0_ from OPS_HEALTH_SCORES_HISTORY historyObjTemp_ \
             where historyObjTemp_.BELONGSTO_ORG_ID=this_.BELONGSTO_ORG_ID )) \
          and orgunittyp2_.ID= :orgUnitTypeId and orgunit1_.TENANT_ID= :tenantID
 
UserCategory.getUsersStatus=\
select us.active_ \
from com.flexnet.platform.bizobjects.User as us \
inner join us.contactInfo_ as con where  con.email_=:userEmail AND us.tenantId_=:tenantId

EntitlementLineItem.getCreatedByandLastModifiedBy=\
select  userData.id , userData.userId_  \
from com.flexnet.platform.bizobjects.User AS userData \
where (userData.id = :id1 OR userData.id=:id2) AND userData.tenantId_=:tenantId

User.saveUserAndPartNumberMapping=\
insert into OPS_SKU_USER(SKU_ID, USER_ID, TENANT_ID) values ((select ID from PROD_SKU where SKU=? and TENANT_ID=?), (select ID from PLT_USER where USERID=? and TENANT_ID=?), ?) 

Entitlement.saveUserAndPartNumberMapping=\
insert into OPS_SKU_USER(SKU_ID, USER_ID, TENANT_ID) values ((select ID from PROD_SKU where SKU=(select sku.SKU from PROD_SKU sku \
join OPS_ENTITLEMENT_PRODUCT prod on sku.ID \= prod.SKU \
join OPS_ACTIVATABLE_ITEM actItem on actItem.ENTITLEMENT_PRODUCT_ID \= prod.ID \
where actItem.ACTIVATION_ID \= ? and actItem.TENANT_ID \= ?) and TENANT_ID \= ?), (select ID from PLT_USER where USERID=? and TENANT_ID=?), ?) 


Sku.getSkuAvailableForTrialForExistingCustomer=\
select sku.SKU, orderable.NAME, orderable.VERSION, orderable.DESCRIPTION, sku.LICENSE_MODEL_ID  from PROD_SKU sku join PROD_ORDERABLE orderable \
on sku.ORDERABLE_ID=orderable.ID join PROD_LICENSE_MODEL model \
on model.ID=sku.LICENSE_MODEL_ID \
where sku.ID not in(select SKU_ID from OPS_SKU_USER where USER_ID = (select ID from PLT_USER where CONTACTINFO_ID= :userId)  \
AND TENANT_ID = (select TENANT_ID from PLT_USER where CONTACTINFO_ID= :userId)) \
and TRIAL_AVAIL_IND=1 and orderable.STATUS='bo.constants.states.deployed' \
and model.STATUS='bo.constants.states.deployed' \
and sku.TENANT_ID= :tenantId \
and model.DURATION IS NOT NULL

Product.findByOrderableId=\
from com.flexnet.products.bizobjects.OrderableLicenseModelBO olm where olm.orderable_=? and (olm.tenantId_= :tenantId or olm.tenantId_ is null)

Product.findByLicModelId = \
	from com.flexnet.products.bizobjects.OrderableLicenseModelBO olm where olm.licenseModel_=? and olm.tenantId_= :tenantId

OrderableLicenseModel.removeLicenseModel=\
DELETE FROM PROD_ORDERABLE_MODEL \
WHERE LPORDERABLE_ID=:LPORDERABLE_ID AND LICMODEL_ID=:LICMODEL_ID and (TENANT_ID= :tenantId OR TENANT_ID is null)

#SESEmailDomain Verification Queries
	
SESEmailDomainVerificationBO.getEmailByTenentId=\
SELECT S.email from com.flexnet.operations.bizobjects.administer.SESEmailDomainVerificationBO S \
where S.tenantId= :tenantId AND S.email IS NOT NULL
	
SESEmailDomainVerificationBO.getDomainByTenentId=\
SELECT S.domain from com.flexnet.operations.bizobjects.administer.SESEmailDomainVerificationBO S \
where S.tenantId= :tenantId AND S.domain IS NOT NULL
	
SESEmailDomainVerificationBO.deleteEmail=\
DELETE from com.flexnet.operations.bizobjects.administer.SESEmailDomainVerificationBO \
where tenantId= :tenantId AND email= :emailAddr
	
SESEmailDomainVerificationBO.deleteDomain=\
DELETE from com.flexnet.operations.bizobjects.administer.SESEmailDomainVerificationBO \
where tenantId= :tenantId AND domain= :domainAddr

BouncedEmailBO.getBouncedEmailIds=\
select b.RECIPIENT_EMAIL_ADDRESS from OPS_BOUNCED_EMAIL_HISTORY b \
where b.TENANT_ID= :tenantId
	
FNPTimezone.getFNPSupportedTimezone=\
select b.NAME, b.FNP_VALUE, b.DESCRIPTION from PLT_FNP_SUPPORTED_TIMEZONES b 

FNPTimezone.getTimezoneWithName=\
 from com.flexnet.products.bizobjects.FNPTimeZoneDO tz \
where tz.tenantId_ IN(:tenantId, 'ALL') AND tz.name=:name

FNPTimezone.getServerOnlyTimezone=\
 from com.flexnet.products.bizobjects.FNPTimeZoneDO tz \
where tz.tenantId_ IN(:tenantId, 'ALL') AND tz.isServed_=1

FNPTimezone.getExistingTimezone=\
	from com.flexnet.products.bizobjects.FNPTimeZoneDO tz \
where tz.tenantId_= :tenantId order by tz.name ASC


User.deleteUsersFromEmailTemplates=\
delete from OPS_EMAIL_TO_TEMPLATE where email_addr = ? 

DownloadPackage.customAttribute=\
 select DP.id \
 from com.flexnet.operations.bizobjects.downloadpackage.DownloadPackage DP \
 join com.flexnet.operations.bizobjects.downloadpackage.DownloadPackageCustomAttributes DPcustomAttr on DP.id = DPcustomAttr.downloadPackageId \
 join com.flexnet.platform.bizobjects.ExtendedPropertyMetadata extPropMetaData on DPcustomAttr.metadata = extPropMetaData.id \
 where extPropMetaData.className = 'com.flexnet.operations.bizobjects.downloadpackage.DownloadPackage' \
 and extPropMetaData.name = :name \
 and extPropMetaData.type = :type \
 and DP.tenantId = :tenantId \
 and DPcustomAttr.tenantId = :tenantId \
 and extPropMetaData.tenantId_ = :tenantId 

 AutoComplete.targetAccountDetails=\
 select account.NAME ,account.DISPLAYNAME from PLT_ORGUNIT as account INNER JOIN PLT_ORGUNIT_ORGUNITTYPE types_5_ ON account.ID=types_5_.ORGUNIT_ID INNER JOIN PLT_ORGUNITTYPE  orgType ON types_5_.ORGUNITTYPE_ID=orgType.ID where orgType.NAME='CUSTOMER' \
 and ( account.DISPLAYNAME like :acctName or account.NAME like :acctName) \
 and account.TENANT_ID = :tenantId \
 order by account.DISPLAYNAME ASC , account.NAME ASC
 
 AutoComplete.sourceAccountDetails=\
 select account.NAME ,account.DISPLAYNAME from PLT_ORGUNIT as account INNER JOIN PLT_ORGUNIT_ORGUNITTYPE types_5_ ON account.ID=types_5_.ORGUNIT_ID INNER JOIN PLT_ORGUNITTYPE  orgType ON types_5_.ORGUNITTYPE_ID=orgType.ID \
 where (orgType.NAME='CUSTOMER' or orgType.NAME='SELF_REGISTERED') \
 and ( account.DISPLAYNAME like :acctName or account.NAME like :acctName) \
 and account.TENANT_ID = :tenantId \
 order by account.DISPLAYNAME ASC , account.NAME ASC

EPAutoComplete.targetAccountDetails=\
 select account.NAME ,account.DISPLAYNAME from PLT_ORGUNIT as account INNER JOIN PLT_ORGUNIT_ORGUNITTYPE types_5_ ON account.ID=types_5_.ORGUNIT_ID INNER JOIN PLT_ORGUNITTYPE  orgType ON types_5_.ORGUNITTYPE_ID=orgType.ID where orgType.NAME='CUSTOMER' \
 and ( account.DISPLAYNAME like :acctName or account.NAME like :acctName) \
 and (account.ID in (select ORGID from OPS_ORGHIERARCHY where PARENTORGID IS NOT NULL and (LINEAGE like :soldToId1 or LINEAGE like :soldToId2 or LINEAGE like :soldToId3 ))) \
 and account.TENANT_ID = :tenantId \
 order by account.DISPLAYNAME ASC , account.NAME ASC
 
EPAutoComplete.relatedAccountsOfLoggedInUserAccount=\
 SELECT DISTINCT account.NAME, account.DISPLAYNAME from PLT_ORGUNIT as account \
 INNER JOIN OPS_RELATED_ORGS relatedOrg ON account.ID = relatedOrg.RELATED_OPS_ORG_ID \
 INNER JOIN PLT_ORGUNIT_ORGUNITTYPE types_5_ ON account.ID=types_5_.ORGUNIT_ID  \
 INNER JOIN PLT_ORGUNITTYPE  orgType ON types_5_.ORGUNITTYPE_ID=orgType.ID  \
 where relatedOrg.OPS_ORG_ID IN (SELECT account.ID from PLT_ORGUNIT as account  \
 INNER JOIN PLT_ORGUNIT_CONTACT as orgUnitContact ON account.ID = orgUnitContact.ORG_ID  \
 INNER JOIN PLT_CONTACT as contact ON orgUnitContact.CONTACTINFO_ID = contact.ID  \
 WHERE contact.EMAIL = :email)  \
 AND orgType.NAME='CUSTOMER' \
 AND account.TENANT_ID = :tenantId \
 AND account.Name like :acctName OR account.DISPLAYNAME like :acctName 
 
EPAutoComplete.accountHierarchyOfLoggedInUserAccount=\
select account.NAME, account.DISPLAYNAME from PLT_ORGUNIT as account \
 INNER JOIN PLT_ORGUNIT_ORGUNITTYPE types_5_ ON account.ID=types_5_.ORGUNIT_ID \
 INNER JOIN PLT_ORGUNITTYPE  orgType ON types_5_.ORGUNITTYPE_ID=orgType.ID \
 where orgType.NAME='CUSTOMER' \
 AND account.TENANT_ID = :tenantId \
 AND (account.Name like :acctName OR account.DISPLAYNAME like :acctName)\
 AND (account.ID IN (SELECT orgHierarchy.ORGID \
						FROM  OPS_ORGHIERARCHY as orgHierarchy \
						WHERE EXISTS (SELECT 1 \
										FROM PLT_ORGUNIT as account \
										INNER JOIN PLT_ORGUNIT_CONTACT as orgUnitContact ON account.ID = orgUnitContact.ORG_ID \
										INNER JOIN PLT_CONTACT as contact ON orgUnitContact.CONTACTINFO_ID = contact.ID \
										WHERE contact.EMAIL = :email \
										AND (orgHierarchy.LINEAGE like account.id OR orgHierarchy.LINEAGE like CONCAT(account.id,'.%')))))
										
  
Product.getLatestProductIds=\
    select product.id from com.flexnet.products.bizobjects.Orderable AS product \
    where product.auditInfo.updatedOn >= :after  and product.auditInfo.updatedOn < :before \
      AND product.tenantId_=:tenantId order by product.id
      
Product.getAllProductIds=\
    select product.id from com.flexnet.products.bizobjects.Orderable AS product \
    where product.tenantId_=:tenantId order by product.id
           
Prod.getLatestProducts=\
    select product from com.flexnet.products.bizobjects.Orderable AS product \
    where product.id IN (:idList) \
      AND product.tenantId_=:tenantId order by product.id         
 
OrgUnit.getOrgsByIDSet=\
SELECT obj FROM com.flexnet.platform.bizobjects.OrgUnit AS obj \
	where obj.id in (:ids) and obj.tenantId_=:tenantId

ActivatableItemBO.getActivatablesByTenantId=\
select actItem.* from OPS_MAINTENANCE_TO_ACTIVATABLE as mappingRecord join OPS_ACTIVATABLE_ITEM as actItem on mappingRecord.ACTIVATEABLE_ITEM_ID=actItem.ID and actItem.TENANT_ID=:tenantId \
where mappingRecord.MAINTENANCE_ITEM_ID= :maintId 

EntitlementPoliciesBO.deleteEntitlementPolicies=\
delete from OPS_ENTITLEMENT_POLICIES where ID = :policyId and TENANT_ID = :tenantId

EntitlementPoliciesBO.deleteLifeCyclePolicies=\
delete from PROD_LIFECYCLE_POLICY where ID in (:policyIds) and TENANT_ID = :tenantId

EntitlementPoliciesBO.deleteHostIdPolicies=\
delete from PROD_HOST_ID_POLICY where ID in (:policyIds) and TENANT_ID = :tenantId

EntitlementPoliciesBO.deleteRedServerPolicies=\
delete from PROD_REDUNDANT_SERVER_POLICY where ID in (:policyIds) and TENANT_ID = :tenantId

EntitlementPoliciesBO.deleteReinstallDetailsPolicies=\
delete from PROD_REINSTALL_POLICY_DETAILS where REINSTALL_POLICY_ID in (:policyIds) and TENANT_ID = :tenantId

EntitlementPoliciesBO.deleteReinstallPolicies=\
delete from PROD_REINSTALL_POLICY where ID in (:policyIds) and TENANT_ID = :tenantId

EntitlementPoliciesBO.deleteBooleanPolicies=\
delete from PROD_BOOLEAN_POLICY where ID in (:policyIds) and TENANT_ID = :tenantId

CustomeAttributeConfiguredToPortal=\
SELECT FIELD_NAME from OPS_PORTAL_CONFIG where tenant_id= :tenantId AND IS_CUSTOM_LINEITEM_ATTRIBUTE=1

UserAccount.listAdministrators=\
select distinct contact.DISPLAYNAME,contact.email,org.displayname \
from PLT_USER_ORGUNIT_ROLE userorgrole inner join PLT_ORGUNIT org on org.id=userorgrole.ORG_ID and org.TENANT_ID=userorgrole.TENANT_ID \
inner join PLT_ROLE role1 on role1.id=userorgrole.ROLE_ID and role1.TENANT_ID=userorgrole.TENANT_ID \
inner join PLT_USER user1 on user1.id=userorgrole.user_id and user1.TENANT_ID=userorgrole.TENANT_ID \
inner join PLT_CONTACT contact on user1.CONTACTINFO_ID=contact.id and user1.TENANT_ID=contact.TENANT_ID \
where org.NAME in (:orgs) and role1.NAME in (:roles)  and user1.active=1 and userorgrole.TENANT_ID=convert(nvarchar(255),:tenantId) \
order by contact.displayname asc

ActivatableItemBO.getActivatableIds=\
select activatabl0_.ID \
from OPS_ACTIVATABLE_ITEM activatabl0_ inner join OPS_ENTITLEMENT_PRODUCT entitlemen1_ on activatabl0_.ENTITLEMENT_PRODUCT_ID=entitlemen1_.ID  \
and (activatabl0_.TENANT_ID=entitlemen1_.TENANT_ID) inner join PROD_LICENSE_MODEL licensemod7_ on entitlemen1_.LICENSEMODEL_ID=licensemod7_.ID  \
and (licensemod7_.TENANT_ID=activatabl0_.TENANT_ID) left outer join PROD_LICENSE_MODEL licensemod9_ on \
entitlemen1_.ALT_LICENSEMODEL1_ID=licensemod9_.ID and (licensemod9_.TENANT_ID=activatabl0_.TENANT_ID) left outer join PROD_LICENSE_MODEL \
licensemod10_ on entitlemen1_.ALT_LICENSEMODEL2_ID=licensemod10_.ID and (licensemod10_.TENANT_ID=activatabl0_.TENANT_ID) inner join \
OPS_ENTITLEMENT_ORDER entitlemen2_ on activatabl0_.PARENT_ENTITLEMENT_ID=entitlemen2_.ID and (activatabl0_.TENANT_ID=entitlemen2_.TENANT_ID)  \
inner join OPS_CHANNEL_PARTNER_SET channelpar3_ on entitlemen2_.CHANNEL_PARTNER_SET=channelpar3_.ID and (  \
channelpar3_.TENANT_ID=entitlemen2_.TENANT_ID) inner join OPS_ENT_PARTNER_TIER channelpar4_ on channelpar3_.ID=channelpar4_.CHANNEL_PARTNER_SET_ID  \
and (channelpar4_.TENANT_ID=activatabl0_.TENANT_ID) inner join OPS_PARTNER_TIER_NAME partnertie5_ on channelpar4_.PARTNER_TIER_ID=partnertie5_.ID  \
and (partnertie5_.TENANT_ID=activatabl0_.TENANT_ID) inner join PLT_ORGUNIT orgunit6_ on channelpar4_.ORG_UNIT_ID=orgunit6_.ID  \
and (channelpar4_.TENANT_ID=orgunit6_.TENANT_ID) where activatabl0_.ACTIVATABLE_ITEM_TYPE in ('com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO', 'bo.constants.activatableitem.type.webregkey', \
'bo.constants.activatableitem.type.entitlement_line_item')  and activatabl0_.TENANT_ID=CONVERT(nvarchar(255), :tenantId)  \
and partnertie5_.NAME='bo.constants.partnertiernames.endcustomer' and (licensemod7_.MODEL_TYPE='EMBEDDED' or licensemod9_.MODEL_TYPE='EMBEDDED'  \
or licensemod10_.MODEL_TYPE='EMBEDDED')  and entitlemen1_.REMAINING_COPIES>0  and  (entitlemen1_.VALID_UNTIL>=:getToDate or entitlemen1_.IS_PERMANENT=1 )  \
and (activatabl0_.STATUS='bo.constants.states.test' or activatabl0_.STATUS='bo.constants.states.deployed') and (    \
entitlemen2_.STATUS='bo.constants.states.test' or entitlemen2_.STATUS='bo.constants.states.deployed') and activatabl0_.IS_BULK_LINE_ITEM<>1  

ActivatableItemBO.getOrgActivatableIdsForCustomer=\
select activatabl0_.ID from OPS_ACTIVATABLE_ITEM activatabl0_ inner join OPS_ENTITLEMENT_PRODUCT entitlemen1_ on \
activatabl0_.ENTITLEMENT_PRODUCT_ID=entitlemen1_.ID and (activatabl0_.TENANT_ID=entitlemen1_.TENANT_ID) inner join \
PROD_LICENSE_MODEL licensemod2_ on entitlemen1_.LICENSEMODEL_ID=licensemod2_.ID and (licensemod2_.TENANT_ID=activatabl0_.TENANT_ID) \
left outer join PROD_LICENSE_MODEL licensemod5_ on entitlemen1_.ALT_LICENSEMODEL1_ID=licensemod5_.ID and \
(licensemod5_.TENANT_ID=activatabl0_.TENANT_ID) left outer join PROD_LICENSE_MODEL licensemod6_ on entitlemen1_.ALT_LICENSEMODEL2_ID=licensemod6_.ID \
and (licensemod6_.TENANT_ID=activatabl0_.TENANT_ID) inner join OPS_ENTITLEMENT_ORDER entitlemen3_ on activatabl0_.PARENT_ENTITLEMENT_ID=entitlemen3_.ID inner join OPS_CHANNEL_PARTNER_SET channelpar4_ \
on entitlemen3_.CHANNEL_PARTNER_SET=channelpar4_.ID where activatabl0_.ACTIVATABLE_ITEM_TYPE in ('com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO',\
'bo.constants.activatableitem.type.webregkey', 'bo.constants.activatableitem.type.entitlement_line_item') and activatabl0_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and \
(licensemod2_.MODEL_TYPE='EMBEDDED' or licensemod5_.MODEL_TYPE='EMBEDDED' or licensemod6_.MODEL_TYPE='EMBEDDED') \
and entitlemen1_.REMAINING_COPIES>0  and  (entitlemen1_.VALID_UNTIL>=:getToDate or entitlemen1_.IS_PERMANENT=1 ) \
and (activatabl0_.STATUS='bo.constants.states.test' or activatabl0_.STATUS='bo.constants.states.deployed') \
and (entitlemen3_.STATUS='bo.constants.states.test' or entitlemen3_.STATUS='bo.constants.states.deployed') and activatabl0_.IS_BULK_LINE_ITEM<>1 \
and (channelpar4_.ID in (select channelpar7_.ID from OPS_CHANNEL_PARTNER_SET channelpar7_ inner join OPS_ENT_PARTNER_TIER channelpar8_ \
on channelpar7_.ID=channelpar8_.CHANNEL_PARTNER_SET_ID and (channelpar8_.TENANT_ID=channelpar7_.TENANT_ID) inner join PLT_ORGUNIT orgunit9_ on \
channelpar8_.ORG_UNIT_ID=orgunit9_.ID where channelpar7_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and orgunit9_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) \
and (orgunit9_.ID in (select orghierarc10_.ORGID from OPS_ORGHIERARCHY orghierarc10_ where orghierarc10_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and 


ActivatableItemBO.getActivatableIdsForPublisherNotPortal=\
select activatabl0_.ID from OPS_ACTIVATABLE_ITEM activatabl0_ inner join OPS_ENTITLEMENT_PRODUCT entitlemen1_ on \
  activatabl0_.ENTITLEMENT_PRODUCT_ID=entitlemen1_.ID and (activatabl0_.TENANT_ID=entitlemen1_.TENANT_ID) inner join \
  PROD_LICENSE_MODEL licensemod7_ on entitlemen1_.LICENSEMODEL_ID=licensemod7_.ID and (licensemod7_.TENANT_ID=activatabl0_.TENANT_ID) \
  left outer join PROD_LICENSE_MODEL licensemod9_ on entitlemen1_.ALT_LICENSEMODEL1_ID=licensemod9_.ID and \
  (licensemod9_.TENANT_ID=activatabl0_.TENANT_ID) left outer join PROD_LICENSE_MODEL licensemod10_ on \
  entitlemen1_.ALT_LICENSEMODEL2_ID=licensemod10_.ID and (licensemod10_.TENANT_ID=activatabl0_.TENANT_ID) inner join \
  OPS_ENTITLEMENT_ORDER entitlemen2_ on activatabl0_.PARENT_ENTITLEMENT_ID=entitlemen2_.ID and (activatabl0_.TENANT_ID=entitlemen2_.TENANT_ID) \
  inner join OPS_CHANNEL_PARTNER_SET channelpar3_ on entitlemen2_.CHANNEL_PARTNER_SET=channelpar3_.ID and (channelpar3_.TENANT_ID=entitlemen2_.TENANT_ID) \
  inner join OPS_ENT_PARTNER_TIER channelpar4_ on channelpar3_.ID=channelpar4_.CHANNEL_PARTNER_SET_ID and (channelpar4_.TENANT_ID=activatabl0_.TENANT_ID) \
  inner join OPS_PARTNER_TIER_NAME partnertie5_ on channelpar4_.PARTNER_TIER_ID=partnertie5_.ID and (partnertie5_.TENANT_ID=activatabl0_.TENANT_ID) \
  inner join PLT_ORGUNIT orgunit6_ on channelpar4_.ORG_UNIT_ID=orgunit6_.ID and (channelpar4_.TENANT_ID=orgunit6_.TENANT_ID) where \
  activatabl0_.ACTIVATABLE_ITEM_TYPE in ('com.flexnet.operations.bizobjects.entitlements.ActivatableItemBO', 'bo.constants.activatableitem.type.webregkey', \
  'bo.constants.activatableitem.type.entitlement_line_item') and activatabl0_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and \
  partnertie5_.NAME='bo.constants.partnertiernames.endcustomer' and channelpar3_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and \
  channelpar4_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and orgunit6_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and \
  partnertie5_.TENANT_ID=CONVERT(nvarchar(255), :tenantId) and partnertie5_.NAME='bo.constants.partnertiernames.endcustomer' \
  and orgunit6_.NAME in (:soldTo) and (licensemod7_.MODEL_TYPE='EMBEDDED' or licensemod9_.MODEL_TYPE='EMBEDDED' or \
  licensemod10_.MODEL_TYPE='EMBEDDED') and activatabl0_.STATUS='bo.constants.states.deployed' and \
  (activatabl0_.STATUS='bo.constants.states.test' or activatabl0_.STATUS='bo.constants.states.deployed') and \
  (entitlemen2_.STATUS='bo.constants.states.test'  or entitlemen2_.STATUS='bo.constants.states.deployed') and \
  activatabl0_.IS_BULK_LINE_ITEM<>1  and entitlemen1_.REMAINING_COPIES>0  and \
  (entitlemen1_.VALID_UNTIL>=:getToDate or entitlemen1_.IS_PERMANENT=1 )


ActivatableItemBO.getActivatableIdsWithActId=\
  and activatabl0_.ACTIVATION_ID like :searchId order by activatabl0_.LAST_MODIFIED desc

ActivatableItemBO.getActivatableIdsWithSearch=\
  order by activatabl0_.LAST_MODIFIED desc

ActivatableItemBO.getActivatableIdsWithProd=\
  and activatabl0_.ID in ( SELECT activatabl0_.ID FROM OPS_ENTORDERABLE_SET entitleset_, OPS_ACTIVATABLE_ITEM activatabl0_ \
  WHERE activatabl0_.ENTITLED_ORDERABLES = entitleset_.ID and try_cast(entitleset_.PRODUCT_IDS AS numeric) in ( select ID from PROD_ORDERABLE \
  where name like :searchId) ) order by activatabl0_.LAST_MODIFIED desc

LineItemRenewalJob.getLineItemsBasedOnRenewalConfig=\
select distinct ai \
from ActivatableItemBO ai \
join EntitlementProductBO ep \
ON ai.entitlementProduct_=ep.id \
left join ActivatableMaintenanceBO ma \
ON ma.activatableItem = ai.id \
left join MaintenanceItemDO mi \
ON mi.id = ma.maintenanceItem \
where (ep.permanent_=0 OR ep.permanent_ is NULL) \
and ep.renewal_=1 \
and (mi.permanent_=0 OR mi.permanent_ is NULL) \
and ep.validUntil_ < ep.renewalValidUntil_ \
and ep.validUntil_ <= DATEADD(day, 1, GETDATE()) \
and ep.renewalValidUntil_ IS NOT NULL \
and ep.validUntil_ IS NOT NULL \
and ai.status_='bo.constants.states.deployed' \
and ep.tenantId_= convert(nvarchar(255),:tenantId)

ActivatableItem.updateLastModifiedDateAndUpdateBy = \
    update OPS_ACTIVATABLE_ITEM set LAST_MODIFIED=?,AUDIT_UPDATEDBY=?  where TENANT_ID=? and ACTIVATION_ID=?
